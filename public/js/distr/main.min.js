function request(e,t,n,o){const i=new XMLHttpRequest;i.onreadystatechange=function(){4==this.readyState&&200==this.status?o("success",this):4==this.readyState&&500==this.status&&o("error",this)},i.onerror=function(e){0==e.currentTarget.status&&o("econn")},i.open(e,t,!0),!1!==n?(i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i.send(n)):i.send()}function Auth(e=""){const t=this;this.BASE_URL=e,this.authBt=document.getElementById("auth-bt"),this.login=document.getElementById("login"),this.pass=document.getElementById("pass"),this.authBt.onclick=function(){let e=t.login.value,n=t.pass.value;if(!e||!n)return alert("Отсутствует логин или пароль");request("POST",t.BASE_URL+"/auth",`login=${e}&pass=${n}`,(function(e,n){if("success"==e)return alert("Авторизация успешна и будет действительна в течение 30 дней"),""===t.BASE_URL?window.location.href="/":Rocky.setWorkspaceTo("performances");"error"!=e||alert("Ошибка авторизации, проверьте введённые Вами данные")}))}}function Authenticate(e=""){const t=this;this.BASE_URL=e,this.login=document.getElementById("login"),this.pass1=document.getElementById("pass1"),this.pass2=document.getElementById("pass2"),this.authenBt=document.getElementById("authenticate-bt"),this.login.onclick=function(){t.login.style.borderColor="initial"},this.pass1.onclick=function(){t.pass1.style.borderColor="initial"},this.pass2.onclick=function(){t.pass2.style.borderColor="initial"},this.authenBt.onclick=function(){if(!t.login.value)return t.login.style.borderColor="red";if(!t.pass1.value)return t.pass1.style.borderColor="red";if(!t.pass2.value)return t.pass2.style.borderColor="red";let e=t.login.value,n=t.pass1.value,o=t.pass2.value,i=`login=${e}&pass1=${n}&pass2=${o}`;if(n!==o)return alert("Введённые пароли не совпадают");request("POST",t.BASE_URL+"/authenticate",i,(function(e,n){if("success"==e)return alert("Аутентификация успешна, сейчас вы будете перенаправлены на страницу логина"),""===t.BASE_URL?window.location.href="/auth":Rocky.setWorkspaceTo("login");"error"!=e||alert("Ошибка аутентификации, проверьте все поля")}))}}function updateBreadcrump(){const e=document.getElementById("bread-crump"),t=window.location.pathname;e.textContent={"/":"Главная","/materials":"Материалы","/performances":"Спектакли"}[t]}function Notes(e=""){const t=this;this.BASE_URL=e;document.getElementById("last-notes");this.createHtmlForNote=()=>{document.createElement("div")},this.uploadLastTenNotes=()=>{request("POST",t.BASE_URL+"/notes","get=last10notes",(e,t)=>{if("success"==e);else if("error"==e)return void alert("Ошибка запроса последних заметок, проверьте соединение или попробуйте позже")})}}function Performance(e="",t="false"){const n=this;this.BASE_URL=e,this.pointsData={leftSide:{},rightSide:{}},this.totalPointsNum=0,this.addPerfBtn=document.getElementById("add-performance-btn"),this.preloader=document.getElementById("preloader"),this.searchInpt=document.getElementById("search-perfs"),this.backgroundModal=document.getElementById("background-modal"),this.closeAddPerf=document.getElementById("close-adding-perf"),this.savePerfBtn=document.getElementById("save-perf-btn"),this.perfName=document.getElementById("perf-name"),this.perfType=document.getElementById("perf-type"),this.perfUrl=document.getElementById("perf-pic-url"),this.perfActs=document.getElementById("perf-acts"),this.perfPoints=document.getElementById("perf-points"),this.perfNotes=document.getElementById("perf-notes"),this.addActBtn=document.getElementById("add-act"),this.searchResults=document.getElementById("search-results"),this.closeCardPerf=document.getElementById("close-card-perf"),this.backgroundCard=document.getElementById("card-back"),this.addPointsBtn=document.getElementById("add-points"),this.addRightPointBtn=document.getElementById("add-right-pt-btn"),this.addLeftPointBtn=document.getElementById("add-left-pt-btn"),this.backgroundPoints=document.getElementById("points-back"),this.closeEditPointsBtn=document.getElementById("close-points-perf"),this.userPointsBack=document.getElementById("user-points-back"),this.closeUserPoints=document.getElementById("close-user-points"),this.cardPerfName=document.getElementById("card-perf-name"),this.cardPerfImg=document.getElementById("card-perf-img"),this.cardPerfType=document.getElementById("card-perf-type"),this.cardPerfActs=document.getElementById("card-perf-acts"),this.cardPerfPoints=document.getElementById("card-perf-points"),this.cardPerfNotes=document.getElementById("card-perf-notes"),this.totalPointsSpan=document.getElementById("total-points-num"),this.getActsEnding=function(e){let t;return t=1==e?e+" акт":e>1&&e<5?e+" акта":e+"актов",t},this.showPerformanceCard=function(){n.backgroundCard.style.display="block",window.scrollTo(0,0)},this.showUsualPointsTable=function(){n.userPointsBack.style.display="block",window.scrollTo(0,0)},this.fillCardPerformanceActs=function(e,t){const o=n.cardPerfType,i=n.cardPerfActs;"ballet"===e?o.textContent=`Балет, ${n.getActsEnding(t.length)}`:"opera"===e&&(o.textContent=`Опера, ${n.getActsEnding(t.length)}`),n.clearDomElement(i,(function(){for(let e=0;e<t.length;e++){let n=document.createElement("div"),o=document.createElement("span"),l=document.createElement("span");n.setAttribute("class","act-line"),o.textContent=`${e+1} Акт:`,l.textContent=`${t[e]}`,n.appendChild(o),n.appendChild(l),i.appendChild(n)}}))},this.fillCardPerformancePoints=function(e){const t=n.cardPerfPoints;if(e){2==t.childNodes.length?t.removeChild(t.childNodes[1]):3==t.childNodes.length&&(t.removeChild(t.childNodes[1]),t.removeChild(t.childNodes[1]));const o=document.createElement("p");o.setAttribute("class","total-points-usr"),o.textContent=`Всего: ${n.countPointsNum(e)} шт.`,t.appendChild(o),n.fillUserPointsTable(e);const i=document.createElement("button");i.setAttribute("class","showPoints-btn"),i.textContent="Просмотр",i.onclick=function(){let e=n.userPointsBack,t=n.backgroundCard;e.style.height=t.offsetHeight+"px",n.showUsualPointsTable()},t.appendChild(i)}else if(3==t.childNodes.length){t.removeChild(t.childNodes[1]),t.removeChild(t.childNodes[1]);const e=document.createElement("i");e.textContent="– Отсутствуют",t.appendChild(e)}},this.fillPerformanceCard=function(e){const o=n.cardPerfName,i=n.cardPerfImg,l=n.cardPerfNotes;if(o.textContent=e.name,e.imgUrl?(i.src=n.BASE_URL+"/static/imgs/performance-imgs/"+e.imgUrl,i.style.display="inline-block"):(i.src=n.BASE_URL+"/static/imgs/performance-imgs/no-photo.png",i.style.display="inline-block"),n.fillCardPerformanceActs(e.type,e.acts),n.fillCardPerformancePoints(e.points),""!=e.notes?l.innerHTML=e.notes:l.textContent="– Отсутствуют","true"===t){let t=document.createElement("button");t.setAttribute("class","edit-btn"),t.textContent="Редактировать",t.onclick=function(){n.openEdit(e)};let i=document.createElement("button");i.setAttribute("class","rm-perf-btn"),i.textContent="Удалить",i.onclick=function(){confirm(`Вы действительно хотите удалить спектакль "${e.name}" из базы?`)&&n.save(e._id,"remove")},5==o.parentElement.childNodes.length?(o.parentElement.appendChild(t),o.parentElement.appendChild(i)):(o.parentElement.childNodes[5].remove(),o.parentElement.childNodes[5].remove(),o.parentElement.appendChild(t),o.parentElement.appendChild(i))}n.savePerfBtn.onclick=function(){n.save(e._id,"update")}},this.clearDomElement=function(e,t){for(;e.firstChild;)e.removeChild(e.firstChild);return t()},this.fillSearchResults=function(e){const t=n.searchResults;if(0==e.length){const e=document.createElement("div");e.setAttribute("class","perf-name-found nothing-found"),e.textContent="Ничего не найдено",t.childNodes[0]||t.appendChild(e)}else for(let o=0;o<e.length;o++){let i=document.createElement("div");i.setAttribute("class","perf-name-found"),i.textContent=e[o].name,i.onclick=function(){n.fillPerformanceCard(e[o]),n.showPerformanceCard()};for(let e=0;e<t.childNodes.length;e++)if(t.childNodes[e].textContent==i.textContent)return;t.appendChild(i)}},this.searchInpt.oninput=function(){n.searchInpt.value&&""!=n.searchInpt.value?n.clearDomElement(n.searchResults,(function(){const e=n.searchInpt.value;if(/^\s*$/.test(e))n.fillSearchResults([]);else{const t=`query=${e}`;n.preloader.style.display="block",request("POST",n.BASE_URL+"/perf-search",t,(function(e,t){if("success"===e){const e=JSON.parse(t.responseText).perfs;n.fillSearchResults(e),n.preloader.style.display="none"}else{if("error"==e)return void(n.preloader.style.display="none");if("econn"==e){n.preloader.style.display="none";const e=document.createElement("div");e.setAttribute("class","perf-name-found nothing-found"),e.textContent="Проверьте интернет соединение",n.searchResults.childNodes[0]||n.searchResults.appendChild(e)}}}))}})):setTimeout((function(){n.clearDomElement(n.searchResults,(function(){}))}),100)},this.openEdit=function(e){if(n.pointsData=e.points,n.backgroundCard.style.display="none",n.backgroundModal.style.display="block",this.perfName.value=e.name,this.perfType.value=e.type,this.perfUrl.value=e.imgUrl,e.acts.length>0){let t,o,i,l,s;this.perfActs.innerHTML="";for(let r=0;r<e.acts.length;r++)t=document.createElement("actLine"),t.setAttribute("class","act-line"),o=document.createElement("span"),o.setAttribute("class","perf-act"),o.textContent=r+1+":",t.appendChild(o),i=document.createElement("input"),i.setAttribute("class","act-time"),i.setAttribute("type","text"),i.setAttribute("placeholder","1ч 15мин"),i.value=e.acts[r],t.appendChild(i),0==r?(s=document.createElement("button"),s.setAttribute("class","add-mini-btn"),s.textContent="+",s.onclick=function(){n.addAct()},t.appendChild(s)):(l=document.createElement("span"),l.setAttribute("class","del-act-btn"),l.textContent="X",l.onclick=function(e){e.target.parentElement.remove()},t.appendChild(l)),em=document.createElement("button"),o.setAttribute("class","perf-act"),this.perfActs.appendChild(t)}n.fillEditCardPointsDiv(e.points),n.fillPointsEditModal(e.points),this.perfNotes.value=e.notes,this.savePerfBtn.textContent="Сохранить изменения",this.savePerfBtn.onclick=function(){n.save(e._id,"update")}},this.fillEditCardPointsDiv=function(e){if(e){n.perfPoints.childNodes[0].remove(),n.perfPoints.childNodes[0].remove();let t=document.createElement("span");t.setAttribute("class","points-number"),t.textContent=n.countPointsNum(e)+" шт.";let o=document.createElement("span");o.setAttribute("class","showPoints-btn"),o.textContent="Редактор",o.onclick=function(){n.fillPointsEditModal(e),n.backgroundPoints.style.height=n.backgroundModal.offsetHeight+"px",n.backgroundPoints.style.display="block",window.scrollTo(0,0)},n.perfPoints.appendChild(t),n.perfPoints.appendChild(o)}},this.isEmpty=function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return JSON.stringify(e)===JSON.stringify({})},this.fillPointsEditModal=function(e){e||(e={});let t=document.getElementById("left-table"),o=document.getElementById("right-table");for(;1!=t.childNodes.length;)t.childNodes[t.childNodes.length-1].remove();for(;1!=o.childNodes.length;)o.childNodes[o.childNodes.length-1].remove();n.totalPointsNum=n.countPointsNum(e);let i,l,s,r,d,a=document.getElementById("total-points-num");for(key1 in a.textContent=n.countPointsNum(e)+" шт.",e.leftSide){if(n.isEmpty(e.leftSide[key1]))continue;let o,l,a;i=document.createElement("tr"),i.setAttribute("class","left-point-rope"),i.appendChild(document.createElement("td")),s=document.createElement("td"),r=document.createElement("td"),d=document.createElement("td"),o=document.createElement("input"),o.setAttribute("type","number"),o.setAttribute("class","lines"),o.value=e.leftSide[key1].stalls.split("/")[0],l=document.createElement("span"),l.textContent="/",a=document.createElement("input"),a.setAttribute("type","number"),a.setAttribute("class","lines"),a.value=e.leftSide[key1].stalls.split("/")[1],s.appendChild(o),s.appendChild(l),s.appendChild(a);let c=document.createElement("input");c.setAttribute("type","number"),c.setAttribute("class","meters"),c.value=e.leftSide[key1].meters,r.appendChild(c);let u=document.createElement("input");u.setAttribute("type","number"),u.setAttribute("class","machine"),u.value=e.leftSide[key1].machine,d.appendChild(u);let m=document.createElement("span");m.setAttribute("class","del-point-rope"),m.textContent="X",m.onclick=function(e){confirm("Удалить эту точку подвеса?")&&(e.target.parentElement.parentElement.remove(),n.totalPointsNum--,n.totalPointsSpan.textContent=n.totalPointsNum+" шт.")},d.appendChild(m),i.appendChild(s),i.appendChild(r),i.appendChild(d),t.appendChild(i)}for(key2 in e.rightSide){if(n.isEmpty(e.rightSide[key2]))continue;let t,i,a;l=document.createElement("tr"),l.setAttribute("class","right-point-rope"),l.appendChild(document.createElement("td")),s=document.createElement("td"),r=document.createElement("td"),d=document.createElement("td"),t=document.createElement("input"),t.setAttribute("type","number"),t.setAttribute("class","lines"),t.value=e.rightSide[key2].stalls.split("/")[0],i=document.createElement("span"),i.textContent="/",a=document.createElement("input"),a.setAttribute("type","number"),a.setAttribute("class","lines"),a.value=e.rightSide[key2].stalls.split("/")[1],s.appendChild(t),s.appendChild(i),s.appendChild(a);let c=document.createElement("input");c.setAttribute("type","number"),c.setAttribute("class","meters"),c.value=e.rightSide[key2].meters,r.appendChild(c);let u=document.createElement("input");u.setAttribute("type","number"),u.setAttribute("class","machine"),u.value=e.rightSide[key2].machine,d.appendChild(u);let m=document.createElement("span");m.setAttribute("class","del-point-rope"),m.textContent="X",m.onclick=function(e){confirm("Удалить эту точку подвеса?")&&(e.target.parentElement.parentElement.remove(),n.totalPointsNum--,n.totalPointsSpan.textContent=n.totalPointsNum+" шт.")},d.appendChild(m),l.appendChild(s),l.appendChild(r),l.appendChild(d),o.appendChild(l)}},this.countPointsNum=function(e){let t=0;if(!e)return 0;for(key1 in e.leftSide)n.isEmpty(e.leftSide[key1])||t++;for(key1 in e.rightSide)n.isEmpty(e.rightSide[key1])||t++;return t},this.closeUserPoints.onclick=function(){n.userPointsBack.style.display="none"},this.fillUserPointsTable=function(e){let t=document.getElementById("left-usr-table"),o=document.getElementById("right-usr-table");for(;t.childNodes[1];)t.childNodes[1].remove();for(;o.childNodes[1];)o.childNodes[1].remove();let i,l,s,r,d,a=document.getElementById("total-user-points");for(key1 in a.textContent=n.countPointsNum(e)+" шт.",e.leftSide)i=document.createElement("tr"),i.appendChild(document.createElement("td")),s=document.createElement("td"),r=document.createElement("td"),d=document.createElement("td"),s.textContent=e.leftSide[key1].stalls,i.appendChild(s),r.textContent=e.leftSide[key1].meters,i.appendChild(r),d.textContent=e.leftSide[key1].machine,i.appendChild(d),t.appendChild(i);for(key2 in e.rightSide)l=document.createElement("tr"),l.appendChild(document.createElement("td")),s=document.createElement("td"),r=document.createElement("td"),d=document.createElement("td"),s.textContent=e.rightSide[key2].stalls,l.appendChild(s),r.textContent=e.rightSide[key2].meters,l.appendChild(r),d.textContent=e.rightSide[key2].machine,l.appendChild(d),o.appendChild(l)},this.saveEditingPoints=function(){let e=document.getElementsByClassName("left-point-rope"),t=document.getElementsByClassName("right-point-rope");if(n.pointsData={leftSide:{},rightSide:{}},0!=e.length||0!=t.length){for(let t=0;t<e.length;t++){n.pointsData.leftSide["point"+(t+1)]={};for(let o=1;o<e[t].childNodes.length;o++)if(1==o){let i=e[t].childNodes[o].firstChild,l=e[t].childNodes[o].lastChild;if(!i.value)return i.parentElement.style.backgroundColor="red",i.onclick=function(){i.parentElement.style.backgroundColor="initial"},void alert("Пустые поля недопустимы, заполните либо удалите пустые точки подвеса");if(!l.value)return l.parentElement.style.backgroundColor="red",l.onclick=function(){l.parentElement.style.backgroundColor="initial"},void alert("Пустые поля недопустимы, заполните либо удалите пустые точки подвеса");n.pointsData.leftSide["point"+(t+1)].stalls=i.value+"/"+l.value}else if(2==o){if(!e[t].childNodes[o].firstChild.value)return e[t].childNodes[o].firstChild.parentElement.style.backgroundColor="red",e[t].childNodes[o].firstChild.onclick=function(){e[t].childNodes[o].firstChild.parentElement.style.backgroundColor="initial"},void alert("Пустые поля недопустимы, заполните либо удалите пустые точки подвеса");n.pointsData.leftSide["point"+(t+1)].meters=e[t].childNodes[o].firstChild.value}else 3==o&&(n.pointsData.leftSide["point"+(t+1)].machine=e[t].childNodes[o].firstChild.value)}for(let e=0;e<t.length;e++){n.pointsData.rightSide["point"+(e+1)]={};for(let o=1;o<t[e].childNodes.length;o++)if(1==o){let i=t[e].childNodes[o].firstChild,l=t[e].childNodes[o].lastChild;if(!i.value)return i.parentElement.style.backgroundColor="red",i.onclick=function(){i.parentElement.style.backgroundColor="initial"},void alert("Пустые поля недопустимы, заполните либо удалите пустые точки подвеса");if(!l.value)return l.parentElement.style.backgroundColor="red",l.onclick=function(){l.parentElement.style.backgroundColor="initial"},void alert("Пустые поля недопустимы, заполните либо удалите пустые точки подвеса");n.pointsData.rightSide["point"+(e+1)].stalls=i.value+"/"+l.value}else if(2==o){if(!t[e].childNodes[o].firstChild.value)return t[e].childNodes[o].firstChild.parentElement.style.backgroundColor="red",t[e].childNodes[o].firstChild.onclick=function(){t[e].childNodes[o].firstChild.parentElement.style.backgroundColor="initial"},void alert("Пустые поля недопустимы, заполните либо удалите пустые точки подвеса");n.pointsData.rightSide["point"+(e+1)].meters=t[e].childNodes[o].firstChild.value}else 3==o&&(n.pointsData.rightSide["point"+(e+1)].machine=t[e].childNodes[o].firstChild.value)}n.fillEditCardPointsDiv(n.pointsData),n.backgroundPoints.style.display="none"}else n.backgroundPoints.style.display="none"},this.closeEditPointsBtn.onclick=function(){n.saveEditingPoints()},this.addPointsBtn.onclick=function(){n.backgroundPoints.style.display="block",window.scrollTo(0,0)},this.closeCardPerf.onclick=function(){n.savePerfBtn.onclick=function(){n.save(!1,"create")},n.backgroundCard.style.display="none"},"true"===t&&(this.addPerfBtn.onclick=function(){n.backgroundModal.style.display="block"}),this.closeAddPerf.onclick=function(){n.backgroundModal.style.display="none"},this.savePerfBtn.onclick=function(){n.save(!1,"create")},this.perfName.onclick=function(){n.perfName.style.borderColor="initial"},this.perfType.onclick=function(){n.perfType.style.borderColor="initial"},this.addActBtn.onclick=function(){n.addAct()},this.addRightPointBtn.onclick=function(){n.addPoint("right")},this.addLeftPointBtn.onclick=function(){n.addPoint("left")},this.addAct=function(){let e=n.perfActs.childNodes.length,t=e+1,o=document.createElement("div"),i=document.createElement("span"),l=document.createElement("input"),s=document.createElement("span");o.setAttribute("class","act-line"),i.setAttribute("class","perf-act"),i.setAttribute("id","perf-act"+t),i.textContent=t+":",l.setAttribute("type","text"),l.setAttribute("class","act-time"),l.setAttribute("id","act-time"+t),l.setAttribute("placeholder","1ч 15мин"),s.setAttribute("id","del-act-btn"+t),s.setAttribute("class","del-act-btn"),s.textContent="X",s.onclick=function(){s.parentElement.remove()},o.appendChild(i),o.appendChild(l),o.appendChild(s),n.perfActs.insertBefore(o,n.perfActs.childNodes[e])},this.checkActs=function(){let e=n.perfActs.childNodes.length,t=n.perfActs.childNodes;for(let n=0;n<e;n++)if(!t[n].childNodes[1].value)return t[n].childNodes[1].style.borderColor="red",t[n].childNodes[1].onclick=function(){return t[n].childNodes[1].style.borderColor="initial"},!1;return!0},this.inputsValid=function(){return n.perfName.value?n.perfType.value?!!n.checkActs()||(n.perfActs.borderColor="red",!1):(n.perfType.style.borderColor="red",!1):(n.perfName.style.borderColor="red",!1)},this.save=function(e,t){if("update"===t||"create"===t){if(n.inputsValid()){let o=n.perfName.value,i=n.perfType.value,l=n.perfUrl.value,s=[],r=n.perfNotes.value;for(let e=0;e<n.perfActs.childNodes.length;e++){if(n.perfActs.childNodes[e].childNodes[1].value.includes(","))return void(n.perfActs.childNodes[e].childNodes[1].style.borderColor="red");s.push(n.perfActs.childNodes[e].childNodes[1].value)}if(e&&"update"===t){let d=`name=${o}&type=${i}&imgUrl=${l}&acts=${s}&points=${JSON.stringify(n.pointsData)}&notes=${r}&perfId=${e}&action=${t}`;request("post",n.BASE_URL+"/performances",d,(function(e,t){if("success"==e)alert("Спектакль обновлен успешно"),n.backgroundModal.style.display="none",window.location.reload();else if("err"==e)return}))}else if(!e&&"create"==t){let e=`name=${o}&type=${i}&imgUrl=${l}&acts=${s}&points=${JSON.stringify(n.pointsData)}&notes=${r}&action=${t}`;request("post",n.BASE_URL+"/performances",e,(function(e,t){if("success"==e)alert("Новый спектакль успешно добавлен"),n.backgroundModal.style.display="none",window.location.reload();else if("err"==e)return}))}}}else"remove"===t&&(perfData=`perfId=${e}&action=${t}`,request("post",n.BASE_URL+"/performances",perfData,(function(e,t){if("success"==e)alert("Спектакль успешно удалён"),n.backgroundModal.style.display="none",window.location.reload();else if("err"==e)return})))},this.addPoint=function(e){let t=document.createElement("tr"),o=document.createElement("span");o.textContent="/";for(let e=0;e<4;e++){let i=document.createElement("td");if(1==e)for(let e=0;e<2;e++){let t=document.createElement("input");t.setAttribute("type","number"),t.setAttribute("class","lines"),1==e&&i.appendChild(o),i.appendChild(t)}else if(2==e){let e=document.createElement("input");e.setAttribute("type","number"),e.setAttribute("class","meters"),i.appendChild(e)}else if(3==e){let e=document.createElement("input"),t=document.createElement("span");t.textContent="X",t.setAttribute("class","del-point-rope"),t.onclick=function(e){confirm("Удалить эту точку подвеса?")&&(e.target.parentElement.parentElement.remove(),n.totalPointsNum--,n.totalPointsSpan.textContent=n.totalPointsNum+" шт.")},e.setAttribute("type","number"),e.setAttribute("class","machine"),i.appendChild(e),i.appendChild(t)}t.appendChild(i)}t.setAttribute("class",e+"-point-rope"),document.getElementById(e+"-table").appendChild(t),n.totalPointsNum++,n.totalPointsSpan.textContent=n.totalPointsNum+" шт."}}function SkedApp(e=""){const t=this;this.BASE_URL=e,this.state=[],this.needToSave=!1,this.todayISODate=new Date(Date.now());const n=["Вс","Пн","Вт","Ср","Чт","Пт","Сб"];this.dayFrom=document.getElementById("day-from"),this.monthFrom=document.getElementById("month-from"),this.yearFrom=document.getElementById("year-from"),this.dayTo=document.getElementById("day-to"),this.monthTo=document.getElementById("month-to"),this.yearTo=document.getElementById("year-to");const o=document.getElementById("sked-main-tb"),i=document.getElementById("next-sked-bt"),l=document.getElementById("save-sked-bt"),s=document.getElementById("prev-sked-bt"),r=document.getElementById("new-sked-bt");this.fillWithWorkers=function(e){const n=e||t.workers;let i,l,s,r,d,a,c=0;for(let t=0;t<n.length;t++){for(i=document.createElement("tr"),i.setAttribute("class","table-row-worker"),l=document.createElement("td"),l.textContent=n[t].username,i.appendChild(l);c<14;){if(l=document.createElement("td"),s=document.createElement("select"),s.setAttribute("class","shift-choose"),r=document.createElement("option"),d=document.createElement("option"),a=document.createElement("option"),r.textContent="–",d.textContent="8.30",a.textContent="16",s.appendChild(r),s.appendChild(d),s.appendChild(a),e)for(key in e[t].shifts)r.textContent==e[t].shifts[key]?r.setAttribute("selected","true"):d.textContent==e[t].shifts[key]?d.setAttribute("selected","true"):a.textContent==e[t].shifts[key]&&a.setAttribute("selected","true");else r.setAttribute("selected","true");l.appendChild(s),i.appendChild(l),c++}o.appendChild(i),c=0}},this.saveState=function(){const e=[],n=document.getElementsByClassName("table-row-worker");for(let t=0;t<n.length;t++){let o={};for(let e=1;e<n[t].childNodes.length;e++)o[e]=n[t].childNodes[e].firstChild.value;let i={};i.username=n[t].firstChild.textContent,i.shifts=o,e.push(i)}const o=`${t.fromISODate.getMonth()+1}/${t.fromISODate.getDate()}/${t.fromISODate.getFullYear()}`,i=`${t.toISODate.getMonth()+1}/${t.toISODate.getDate()}/${t.toISODate.getFullYear()}`;request("POST",t.BASE_URL+"/save-sked",`state=${JSON.stringify(e)}&from=${o}&to=${i}`,(function(e,t){"success"==e?console.log("Sked draft was saved"):"error"==e&&console.error("Error during saving current sked draft state")}))},this.fillUpperDates=function(e,n){let o=new Date(e),i=new Date(n);t.dayFrom.textContent=o.getDate(),t.monthFrom.textContent=o.getMonth()+1,t.yearFrom.textContent=o.getFullYear(),t.dayTo.textContent=i.getDate(),t.monthTo.textContent=i.getMonth()+1,t.yearTo.textContent=i.getFullYear()},this.getSked=function(e,n){const o=e?`from=${e}`:`to=${n}`;request("POST",t.BASE_URL+"/sked",o,(function(e,n){if("success"==e){const e=JSON.parse(n.responseText);if(0!=e.prev&&e.prev?s.style.display="block":s.style.display="none",0==e.next|!e.next?(i.style.display="none",r.style.display="block"):(i.style.display="block",r.style.display="none"),e.sked){const n=e.sked.data;t.fillUpperDates(e.sked.from,e.sked.to),t.fillTableHeader(e.sked.from,e.dates),t.fillWithWorkers(n),t.fromISODate=new Date(e.sked.from),t.toISODate=new Date(e.sked.to)}else r.style.display="none",s.style.display="block",t.fillTableHeader(e.from,e.dates),t.fillUpperDates(e.from,t.toISODate),t.fillWithWorkers(),t.fromISODate=new Date(e.from)}else if("error"==e)return}))},this.init=function(){i&&i.addEventListener("click",(function(){t.saveState(),t.needToSave=!1,t.nextSked()})),l&&(l.onclick=function(){t.saveState()}),r&&(r.onclick=function(){let e;if(t.needToSave=!0,confirm("Создать график с последнего числа предыдущего графика? При отмене график создастся с сегодняшнего дня."))e=`${t.toISODate.getMonth()+1}/${t.toISODate.getDate()}/${t.toISODate.getFullYear()}`;else{const t=new Date(Date.now());e=`${t.getMonth()+1}/${t.getDate()}/${t.getFullYear()}`}const n=document.getElementsByClassName("table-row-worker");for(;n[0];)n[0].remove();t.getSked(e)}),s&&(s.onclick=function(){t.saveState(),t.needToSave=!1;let e=`${t.fromISODate.getMonth()+1}/${t.fromISODate.getDate()}/${t.fromISODate.getFullYear()}`;const n=document.getElementsByClassName("table-row-worker");for(;n[0];)n[0].remove();t.getSked(null,e)}),t.getSked("LAST")},this.nextSked=function(){const e=document.getElementsByClassName("table-row-worker");for(;e[0];)e[0].remove();const n=`${t.toISODate.getMonth()+1}/${t.toISODate.getDate()}/${t.toISODate.getFullYear()}`;t.getSked(n)},this.fillTableHeader=function(e,o){let i=new Date(e).getDate(),l=new Date(e).getDay();const s=document.getElementsByClassName("weekdate");let r=!1;for(let e=0;e<s.length;e++)for(let d=0;d<o.length;d++)if(o[d].date==i){if(r){if("next"!=o[d].type)continue;s[e].textContent=o[d].date+" "+n[l]}else s[e].textContent=o[d].date+" "+n[l];e+1==s.length&&1==t.needToSave&&(t.toISODate=new Date(o[d].iso)),"next"!=o[d+1].type||r?i++:(r=!0,i=1),l<6?l++:l=0;break}}}
//# sourceMappingURL=maps/main.min.js.map
