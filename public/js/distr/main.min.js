class Authenticate{constructor(){this.login=document.getElementById("login"),this.pass1=document.getElementById("pass1"),this.pass2=document.getElementById("pass2"),this.authBtn=document.getElementById("authenticate-bt"),this.login.onclick=()=>{this.login.style.borderColor="transparent"},this.pass1.onclick=()=>{this.pass1.style.borderColor="transparent"},this.pass2.onclick=()=>{this.pass2.style.borderColor="transparent"},this.authBtn.onclick=()=>{this.authenticate()}}async authenticate(){if(!this.login.value)return alert('Поле "Логин" пусто. Придумайте себе логин, чтобы продолжить.'),void(this.login.style.borderColor="#f26a6a");if(!this.pass1.value)return alert('Поле "Пароль" пусто. Придумайте себе пароль, чтобы продолжить.'),void(this.pass1.style.borderColor="#f26a6a");if(!this.pass2.value)return alert('Поле "Пароль повторно" пусто. Введите пароль повторно, чтобы продолжить.'),void(this.pass2.style.borderColor="#f26a6a");if(this.pass1.value!==this.pass2.value)return void alert("Введённые Вами пароли не совпадают");const t={login:this.login.value,pass1:this.pass1.value,pass2:this.pass2.value},e=await request("/authenticate","POST",t);if("Inconsistent data"!=e.statusText)return"Duplicate"==e.statusText?void alert("Такой логин уже занят, придумайте другой"):"Passwords mismatch"==e.statusText?void alert("Пароли не совпадают"):"Authenticated"==e.statusText?(alert("Аутентификация успешна, сейчас вы будете перенаправлены на страницу логина"),void(window.location.href="/auth")):void alert("Ошибка аутентификации");alert("Отсутсвует логин или пароль")}}class Authorisate{constructor(){this.authBtn=document.getElementById("auth-bt"),this.loginInpt=document.getElementById("login"),this.passInpt=document.getElementById("pass"),this.authBtn.onclick=()=>{this.authorise()}}async authorise(){if(!this.loginInpt.value||!this.passInpt.value)return alert("Отсутствует логин или пароль");const t={login:this.loginInpt.value,pass:this.passInpt.value},e=await request("/auth","POST",t);return"Check login and password"==e.statusText?void alert("Неверный логин или пароль"):"Authorised"==e.statusText?(alert("Авторизация успешна и будет действительна в течение 30 дней"),void(window.location.href="/performances")):void alert("Произошла ошибка во время авторизации")}}class Calendars{constructor(){this.stageEvTime=document.getElementById("stage-ev-time"),this.stageEvMsg=document.getElementById("stage-ev-msg"),this.tehEvTime=document.getElementById("teh-ev-time"),this.tehEvMsg=document.getElementById("teh-ev-msg"),this.loadEvTime=document.getElementById("load-ev-time"),this.loadEvMsg=document.getElementById("load-ev-msg"),this.stagePreloader=document.getElementById("stage-preloader"),this.tehPreloader=document.getElementById("teh-preloader"),this.loadPreloader=document.getElementById("load-preloader"),this.stageEvURL="/api/ical/stage",this.tehEvURL="/api/ical/teh-job",this.loadEvURL="/api/ical/load",window.onload=()=>{this.startUpdatingStageEvents()}}startUpdatingStageEvents(){this.updateAllEvents(),setInterval(()=>{this.updateAllEvents()},6e4)}showPreloader(t){"stage"==t?this.stagePreloader.style.display="block":"tech"==t?this.tehPreloader.style.display="block":"load"==t&&(this.loadPreloader.style.display="block")}hidePreloader(t){"stage"==t?this.stagePreloader.style.display="none":"tech"==t?this.tehPreloader.style.display="none":"load"==t&&(this.loadPreloader.style.display="none")}async getCalEvents(t){const e=await request(t,"GET");200!==e.status&&console.error("Error uploading calendar events");return(await e.json()).evts}getTodayEvents(t,e){const s=[];for(let n in t){const i=new Date(t[n].start),a=new Date(t[n].end);i.getFullYear()!=e.getFullYear()||i.getMonth()!=e.getMonth()||i.getDate()!=e.getDate()&&a.getDate()!=e.getDate()||s.push(t[n])}return s}getCurrentEvent(t,e){for(let s=0;s<t.length;s++){const n=new Date(t[s].start).getTime(),i=new Date(t[s].end).getTime(),a=e.getTime();if(n<a&&i>a)return t[s]}return!1}getNextEvent(t,e){let s=e.getTime();for(let e=0;e<5;e++){s+=36e5;for(let e=0;e<t.length;e++){const n=new Date(t[e].start).getTime(),i=new Date(t[e].end).getTime();if(n<s&&i>s)return t[e]}}}async updateAllEvents(){this.showPreloader("stage");const t=await this.getCalEvents(this.stageEvURL);this.showPreloader("tech");const e=await this.getCalEvents(this.tehEvURL);this.showPreloader("load");const s=await this.getCalEvents(this.loadEvURL),n={summary:"Нет данных"},i=new Date(Date.now()),a=this.getTodayEvents(t,i),l=this.getCurrentEvent(a,i),o=this.getNextEvent(a,i);this.setEvent(l||(o||n),i,"stage"),this.hidePreloader("stage");const r=this.getTodayEvents(e,i),d=this.getCurrentEvent(r,i),c=this.getNextEvent(r,i);this.setEvent(d||(c||n),i,"tech"),this.hidePreloader("tech");const h=this.getTodayEvents(s,i),u=this.getCurrentEvent(h,i),m=this.getNextEvent(h,i);this.setEvent(u||(m||n),i,"load"),this.hidePreloader("load")}setEvent(t,e,s){"stage"==s?this.stageEvMsg.textContent=t.summary:"tech"==s?this.tehEvMsg.textContent=t.summary:"load"==s&&(this.loadEvMsg.textContent=t.summary),null!=t.start&&null!=t.end?new Date(t.start).getTime()>e.getTime()?"stage"==s?this.stageEvTime.textContent="Далее: "+this.getRusTime(t.start)+" - "+this.getRusTime(t.end):"tech"==s?this.tehEvTime.textContent="Далее: "+this.getRusTime(evStart)+" - "+this.getRusTime(evEnd):"load"==s&&(this.loadEvTime.textContent="Далее: "+this.getRusTime(evStart)+" - "+this.getRusTime(evEnd)):"stage"==s?this.stageEvTime.textContent="Сейчас: "+this.getRusTime(t.start)+" - "+this.getRusTime(t.end):"tech"==s?this.tehEvTime.textContent="Сейчас: "+this.getRusTime(evStart)+" - "+this.getRusTime(evEnd):"load"==s&&(this.loadEvTime.textContent="Сейчас: "+this.getRusTime(evStart)+" - "+this.getRusTime(evEnd)):"stage"==s?this.stageEvTime.textContent="Сейчас: ":"tech"==s?this.tehEvTime.textContent="Сейчас: ":"load"==s&&(this.loadEvTime.textContent="Сейчас: ")}getRusTime(t){let e=(t=new Date(t)).getHours(),s=t.getMinutes();return 1==s.toString().length&&(s=s.toString()+"0"),e+=":"+s,e}}class iCal{constructor(){this.intId=null,this.nowOnStage=document.getElementById("now-on-stage"),this.nowOrNext=document.getElementById("now-or-next"),window.onload=()=>{this.startPreloader(),this.startUpdatingStageEvents()}}startUpdatingStageEvents(){this.updateStageEvent(),setInterval(()=>{this.updateStageEvent()},12e4)}async updateStageEvent(){const t=await this.getCalEvents(),e=new Date(Date.now()),s=this.getTodayEvents(t,e),n=this.getCurrEvent(s,e),i={summary:"Нет данных"};if(!n){const t=this.getNextEvent(s,e);return this.setEvent(t||i,e)}this.setEvent(n||i,e)}async getCalEvents(){const t=await request("/api/ical/stage","GET");200!==t.status&&(clearInterval(this.intId),this.nowOnStage.textContent="? error ?");return(await t.json()).evts}getTodayEvents(t,e){const s=[];for(let n in t){const i=new Date(t[n].start),a=new Date(t[n].end);i.getFullYear()!=e.getFullYear()||i.getMonth()!=e.getMonth()||i.getDate()!=e.getDate()&&a.getDate()!=e.getDate()||s.push(t[n])}return s}getCurrEvent(t,e){for(let s=0;s<t.length;s++){const n=new Date(t[s].start).getTime(),i=new Date(t[s].end).getTime(),a=e.getTime();if(n<a&&i>a)return t[s]}return!1}getNextEvent(t,e){let s=e.getTime();for(let e=0;e<5;e++){s+=36e5;for(let e=0;e<t.length;e++){const n=new Date(t[e].start).getTime(),i=new Date(t[e].end).getTime();if(n<s&&i>s)return t[e]}}}getRusTime(t){return`${(t=new Date(t)).getHours()}:${1==t.getMinutes().toString().length?t.getMinutes().toString()+"0":t.getMinutes()}`}setEvent(t,e){if(clearInterval(this.intId),t&&"Нет данных"!=t.summary){new Date(t.start).getTime()>e.getTime()?this.nowOrNext.textContent="Далее на сцене:":this.nowOrNext.textContent="Сейчас на сцене:";const s="C "+this.getRusTime(t.start)+" до "+this.getRusTime(t.end);this.nowOnStage.textContent=s+" - "+t.summary}else this.nowOnStage.textContent=t.summary}startPreloader(){let t=".";this.intId=setInterval(()=>{t+=".",this.nowOnStage.textContent=t,t.length>2&&(t="")},400)}}class Performance{constructor(t="",e="false"){this.edit=e,this.pointsData={leftSide:{},rightSide:{}},this.totalPointsNum=0,this.addPerfBtn=document.getElementById("add-performance-btn"),this.preloader=document.getElementById("preloader"),this.searchInpt=document.getElementById("search-perfs"),this.backgroundModal=document.getElementById("background-modal"),this.closeAddPerf=document.getElementById("close-adding-perf"),this.savePerfBtn=document.getElementById("save-perf-btn"),this.perfName=document.getElementById("perf-name"),this.perfType=document.getElementById("perf-type"),this.perfUrl=document.getElementById("perf-pic-url"),this.perfActs=document.getElementById("perf-acts"),this.perfPoints=document.getElementById("perf-points"),this.perfNotes=document.getElementById("perf-notes"),this.addActBtn=document.getElementById("add-act"),this.searchResults=document.getElementById("search-results"),this.closeCardPerf=document.getElementById("close-card-perf"),this.backgroundCard=document.getElementById("card-back"),this.addPointsBtn=document.getElementById("add-points"),this.addRightPointBtn=document.getElementById("add-right-pt-btn"),this.addLeftPointBtn=document.getElementById("add-left-pt-btn"),this.backgroundPoints=document.getElementById("points-back"),this.closeEditPointsBtn=document.getElementById("close-points-perf"),this.userPointsBack=document.getElementById("user-points-back"),this.closeUserPoints=document.getElementById("close-user-points"),this.cardPerfName=document.getElementById("card-perf-name"),this.cardPerfImg=document.getElementById("card-perf-img"),this.cardPerfType=document.getElementById("card-perf-type"),this.cardPerfActs=document.getElementById("card-perf-acts"),this.cardPerfPoints=document.getElementById("card-perf-points"),this.cardPerfNotes=document.getElementById("card-perf-notes"),this.totalPointsSpan=document.getElementById("total-points-num"),"true"===this.edit&&(this.addPerfBtn.onclick=()=>{this.backgroundModal.style.display="block"},this.closeAddPerf.onclick=()=>{this.backgroundModal.style.display="none"},this.savePerfBtn.onclick=()=>{this.save(!1,"create")},this.perfName.onclick=()=>{this.perfName.style.borderColor="initial"},this.perfType.onclick=()=>{this.perfType.style.borderColor="initial"},this.addActBtn.onclick=()=>{this.addAct()},this.addRightPointBtn.onclick=()=>{this.addPoint("right")},this.addLeftPointBtn.onclick=()=>{this.addPoint("left")}),this.closeEditPointsBtn.onclick=()=>{this.saveEditingPoints()},this.addPointsBtn.onclick=()=>{this.backgroundPoints.style.display="block",window.scrollTo(0,0)},this.closeCardPerf.onclick=()=>{this.savePerfBtn.onclick=()=>{this.save(!1,"create")},this.backgroundCard.style.display="none"},this.closeUserPoints.onclick=()=>{this.userPointsBack.style.display="none"},this.searchInpt.oninput=()=>{this.searchInpt.value&&""!=this.searchInpt.value?this.clearDomElement(this.searchResults,async()=>{if(/^\s*$/.test(this.searchInpt.value))this.fillSearchResults([]);else{const t={query:this.searchInpt.value};this.preloader.style.display="block";const e=await request("/perf-search","POST",t);if("OK"==e.statusText){const t=await e.json();this.fillSearchResults(t.perfs),this.preloader.style.display="none"}else{if("error"===e)return this.preloader.style.display="none";if("econn"==e){this.preloader.style.display="none";const t=document.createElement("div");t.setAttribute("class","perf-name-found nothing-found"),t.textContent="Проверьте интернет соединение",this.searchResults.childNodes[0]||this.searchResults.appendChild(t)}}}}):setTimeout(()=>{this.clearDomElement(this.searchResults,()=>{})},100)}}getActsEnding=t=>1==t?t+" акт":t>1&&t<5?t+" акта":t+"актов";showPerformanceCard=()=>{this.backgroundCard.style.display="block",window.scrollTo(0,0)};showUsualPointsTable=()=>{this.userPointsBack.style.display="block",window.scrollTo(0,0)};clearDomElement=(t,e)=>{for(;t.firstChild;)t.firstChild.remove();return e()};fillCardPerformanceActs=(t,e)=>{"ballet"===t?this.cardPerfType.textContent="Балет, "+this.getActsEnding(e.length):"opera"===t&&(this.cardPerfType.textContent="Опера, "+this.getActsEnding(e.length)),this.clearDomElement(this.cardPerfActs,()=>{for(let t=0;t<e.length;t++){let s=document.createElement("div"),n=document.createElement("span"),i=document.createElement("span");s.setAttribute("class","act-line"),n.textContent=t+1+" Акт:",i.textContent=""+e[t],s.appendChild(n),s.appendChild(i),this.cardPerfActs.appendChild(s)}})};fillCardPerformancePoints=t=>{if(t){2==this.cardPerfPoints.childNodes.length?this.cardPerfPoints.childNodes[1].remove():3==this.cardPerfPoints.childNodes.length&&(this.cardPerfPoints.childNodes[1].remove(),this.cardPerfPoints.childNodes[1].remove());const e=document.createElement("p");e.setAttribute("class","total-points-usr"),e.textContent=`Всего: ${this.countPointsNum(t)} шт.`,this.cardPerfPoints.appendChild(e),this.fillUserPointsTable(t);const s=document.createElement("button");s.setAttribute("class","showPoints-btn"),s.textContent="Просмотр",s.onclick=()=>{this.userPointsBack.style.height=this.backgroundCard.offsetHeight+"px",this.showUsualPointsTable()},this.cardPerfPoints.appendChild(s)}else if(3==this.cardPerfPoints.childNodes.length){this.cardPerfPoints.childNodes[1].remove(),this.cardPerfPoints.childNodes[1].remove();const t=document.createElement("i");t.textContent="– Отсутствуют",this.cardPerfPoints.appendChild(t)}};fillPerformanceCard=t=>{if(this.cardPerfName.textContent=t.name,t.imgUrl?(this.cardPerfImg.src=window.location.origin+"/static/imgs/performance-imgs/"+t.imgUrl,this.cardPerfImg.style.display="inline-block"):(this.cardPerfImg.src=window.location.origin+"/static/imgs/performance-imgs/no-photo.png",this.cardPerfImg.style.display="inline-block"),this.fillCardPerformanceActs(t.type,t.acts),this.fillCardPerformancePoints(t.points),""!=t.notes?this.cardPerfNotes.innerHTML=t.notes:this.cardPerfNotes.textContent="– Отсутствуют","true"===this.edit){let e=document.createElement("button");e.setAttribute("class","edit-btn"),e.textContent="Редактировать",e.onclick=()=>{this.openEdit(t)};let s=document.createElement("button");s.setAttribute("class","rm-perf-btn"),s.textContent="Удалить",s.onclick=()=>{confirm(`Вы действительно хотите удалить спектакль "${t.name}" из базы?`)&&this.save(t._id,"remove")},4==this.cardPerfName.parentElement.childNodes.length?(this.cardPerfName.parentElement.appendChild(e),this.cardPerfName.parentElement.appendChild(s)):(this.cardPerfName.parentElement.childNodes[4].remove(),this.cardPerfName.parentElement.childNodes[4].remove(),this.cardPerfName.parentElement.appendChild(e),this.cardPerfName.parentElement.appendChild(s))}this.savePerfBtn.onclick=()=>{this.save(t._id,"update")}};fillSearchResults=t=>{if(0==t.length){const t=document.createElement("div");t.setAttribute("class","perf-name-found nothing-found"),t.textContent="Ничего не найдено",this.searchResults.childNodes[0]||this.searchResults.appendChild(t)}else for(let e=0;e<t.length;e++){let s=document.createElement("div");s.setAttribute("class","perf-name-found"),s.textContent=t[e].name,s.onclick=()=>{this.fillPerformanceCard(t[e]),this.showPerformanceCard()};for(let t=0;t<this.searchResults.childNodes.length;t++)if(this.searchResults.childNodes[t].textContent==s.textContent)return;this.searchResults.appendChild(s)}};openEdit=t=>{if(this.pointsData=t.points,this.backgroundCard.style.display="none",this.backgroundModal.style.display="block",this.perfName.value=t.name,this.perfType.value=t.type,this.perfUrl.value=t.imgUrl,t.acts.length>0){let e,s,n,i,a;this.perfActs.innerHTML="";for(let l=0;l<t.acts.length;l++)e=document.createElement("div"),e.setAttribute("class","act-line"),s=document.createElement("span"),s.setAttribute("class","perf-act"),s.textContent=l+1+":",e.appendChild(s),n=document.createElement("input"),n.setAttribute("class","act-time"),n.setAttribute("type","text"),n.setAttribute("placeholder","1ч 15мин"),n.value=t.acts[l],e.appendChild(n),0==l?(a=document.createElement("button"),a.setAttribute("class","add-mini-btn"),a.textContent="+",a.onclick=()=>{this.addAct()},e.appendChild(a)):(i=document.createElement("span"),i.setAttribute("class","del-act-btn"),i.textContent="X",i.onclick=t=>{t.target.parentElement.remove()},e.appendChild(i)),this.perfActs.appendChild(e);this.fillEditCardPointsDiv(t.points),this.fillPointsEditModal(t.points),this.perfNotes.value=t.notes,this.savePerfBtn.textContent="Сохранить изменения",this.savePerfBtn.onclick=()=>{this.save(t._id,"update")}}};fillEditCardPointsDiv=t=>{if(t){this.perfPoints.childNodes[0].remove(),this.perfPoints.childNodes[0].remove();let e=document.createElement("span");e.setAttribute("class","points-number"),e.textContent=this.countPointsNum(t)+" шт.";let s=document.createElement("span");s.setAttribute("class","showPoints-btn"),s.textContent="Редактор",s.onclick=()=>{this.fillPointsEditModal(t),this.backgroundPoints.style.height=this.backgroundModal.offsetHeight+"px",this.backgroundPoints.style.display="block",window.scrollTo(0,0)},this.perfPoints.appendChild(e),this.perfPoints.appendChild(s)}};isEmpty=t=>{for(var e in t)if(t.hasOwnProperty(e))return!1;return JSON.stringify(t)===JSON.stringify({})};fillPointsEditModal=(t={})=>{let e,s,n,i,a;const l=document.getElementById("left-table").firstChild,o=document.getElementById("right-table").firstChild;for(;l.childNodes.length>1;)l.childNodes[1].remove();for(;o.childNodes.length>1;)o.childNodes[1].remove();this.totalPointsNum=this.countPointsNum(t),document.getElementById("total-points-num").textContent=this.countPointsNum(t)+" шт.";for(const s in t.leftSide){if(this.isEmpty(t.leftSide[s]))continue;let o,r,d;e=document.createElement("tr"),e.setAttribute("class","left-point-rope"),e.appendChild(document.createElement("td")),n=document.createElement("td"),i=document.createElement("td"),a=document.createElement("td"),o=document.createElement("input"),o.setAttribute("type","number"),o.setAttribute("class","lines"),o.value=t.leftSide[s].stalls.split("/")[0],r=document.createElement("span"),r.textContent="/",d=document.createElement("input"),d.setAttribute("type","number"),d.setAttribute("class","lines"),d.value=t.leftSide[s].stalls.split("/")[1],n.appendChild(o),n.appendChild(r),n.appendChild(d);let c=document.createElement("input");c.setAttribute("type","number"),c.setAttribute("class","meters"),c.value=t.leftSide[s].meters,i.appendChild(c);let h=document.createElement("input");h.setAttribute("type","number"),h.setAttribute("class","machine"),h.value=t.leftSide[s].machine,a.appendChild(h);let u=document.createElement("span");u.setAttribute("class","del-point-rope"),u.textContent="X",u.onclick=t=>{confirm("Удалить эту точку подвеса?")&&(t.target.parentElement.parentElement.remove(),this.totalPointsNum--,this.totalPointsSpan.textContent=this.totalPointsNum+" шт.")},a.appendChild(u),e.appendChild(n),e.appendChild(i),e.appendChild(a),l.appendChild(e)}for(const e in t.rightSide){if(this.isEmpty(t.rightSide[e]))continue;let l,r,d;s=document.createElement("tr"),s.setAttribute("class","right-point-rope"),s.appendChild(document.createElement("td")),n=document.createElement("td"),i=document.createElement("td"),a=document.createElement("td"),l=document.createElement("input"),l.setAttribute("type","number"),l.setAttribute("class","lines"),l.value=t.rightSide[e].stalls.split("/")[0],r=document.createElement("span"),r.thenextContent="/",d=document.createElement("input"),d.setAttribute("type","number"),d.setAttribute("class","lines"),d.value=t.rightSide[e].stalls.split("/")[1],n.appendChild(l),n.appendChild(r),n.appendChild(d);let c=document.createElement("input");c.setAttribute("type","number"),c.setAttribute("class","meters"),c.value=t.rightSide[e].meters,i.appendChild(c);let h=document.createElement("input");h.setAttribute("type","number"),h.setAttribute("class","machine"),h.value=t.rightSide[e].machine,a.appendChild(h);let u=document.createElement("span");u.setAttribute("class","del-point-rope"),u.textContent="X",u.onclick=t=>{confirm("Удалить эту точку подвеса?")&&(t.target.parentElement.parentElement.remove(),this.totalPointsNum--,this.totalPointsSpan.textContent=this.totalPointsNum+" шт.")},a.appendChild(u),s.appendChild(n),s.appendChild(i),s.appendChild(a),o.appendChild(s)}};countPointsNum=t=>{let e=0;if(!t)return 0;for(let s in t.leftSide)this.isEmpty(t.leftSide[s])||e++;for(let s in t.rightSide)this.isEmpty(t.rightSide[s])||e++;return e};fillUserPointsTable=t=>{let e,s,n,i,a,l=document.getElementById("left-usr-table").firstChild,o=document.getElementById("right-usr-table").firstChild;for(;l.childNodes.length>1;)l.childNodes[1].remove();for(;o.childNodes.length>1;)o.childNodes[1].remove();document.getElementById("total-user-points").textContent=this.countPointsNum(t)+" шт.";for(const s in t.leftSide)e=document.createElement("tr"),e.appendChild(document.createElement("td")),n=document.createElement("td"),i=document.createElement("td"),a=document.createElement("td"),n.textContent=t.leftSide[s].stalls,e.appendChild(n),i.textContent=t.leftSide[s].meters,e.appendChild(i),a.textContent=t.leftSide[s].machine,e.appendChild(a),l.appendChild(e);for(const e in t.rightSide)s=document.createElement("tr"),s.appendChild(document.createElement("td")),n=document.createElement("td"),i=document.createElement("td"),a=document.createElement("td"),n.textContent=t.rightSide[e].stalls,s.appendChild(n),i.textContent=t.rightSide[e].meters,s.appendChild(i),a.textContent=t.rightSide[e].machine,s.appendChild(a),o.appendChild(s)};saveEditingPoints=()=>{const t=document.getElementsByClassName("left-point-rope"),e=document.getElementsByClassName("right-point-rope");if(this.pointsData={leftSide:{},rightSide:{}},0!=t.length||0!=e.length){for(let e=0;e<t.length;e++){this.pointsData.leftSide["point"+(e+1)]={};for(let s=1;s<t[e].childNodes.length;s++)if(1==s){let n=t[e].childNodes[s].firstChild,i=t[e].childNodes[s].lastChild;if(!n.value)return n.parentElement.style.backgroundColor="red",n.onclick=()=>{n.parentElement.style.backgroundColor="initial"},void alert("Пустые поля недопустимы, заполните либо удалите пустые точки подвеса");if(!i.value)return i.parentElement.style.backgroundColor="red",i.onclick=()=>{i.parentElement.style.backgroundColor="initial"},void alert("Пустые поля недопустимы, заполните либо удалите пустые точки подвеса");this.pointsData.leftSide["point"+(e+1)].stalls=n.value+"/"+i.value}else if(2==s){if(!t[e].childNodes[s].firstChild.value)return t[e].childNodes[s].firstChild.parentElement.style.backgroundColor="red",t[e].childNodes[s].firstChild.onclick=()=>{t[e].childNodes[s].firstChild.parentElement.style.backgroundColor="initial"},void alert("Пустые поля недопустимы, заполните либо удалите пустые точки подвеса");this.pointsData.leftSide["point"+(e+1)].meters=t[e].childNodes[s].firstChild.value}else 3==s&&(this.pointsData.leftSide["point"+(e+1)].machine=t[e].childNodes[s].firstChild.value)}for(let t=0;t<e.length;t++){this.pointsData.rightSide["point"+(t+1)]={};for(let s=1;s<e[t].childNodes.length;s++)if(1==s){let n=e[t].childNodes[s].firstChild,i=e[t].childNodes[s].lastChild;if(!n.value)return n.parentElement.style.backgroundColor="red",n.onclick=()=>{n.parentElement.style.backgroundColor="initial"},void alert("Пустые поля недопустимы, заполните либо удалите пустые точки подвеса");if(!i.value)return i.parentElement.style.backgroundColor="red",i.onclick=()=>{i.parentElement.style.backgroundColor="initial"},void alert("Пустые поля недопустимы, заполните либо удалите пустые точки подвеса");this.pointsData.rightSide["point"+(t+1)].stalls=n.value+"/"+i.value}else if(2==s){if(!e[t].childNodes[s].firstChild.value)return e[t].childNodes[s].firstChild.parentElement.style.backgroundColor="red",e[t].childNodes[s].firstChild.onclick=()=>{e[t].childNodes[s].firstChild.parentElement.style.backgroundColor="initial"},void alert("Пустые поля недопустимы, заполните либо удалите пустые точки подвеса");this.pointsData.rightSide["point"+(t+1)].meters=e[t].childNodes[s].firstChild.value}else 3==s&&(this.pointsData.rightSide["point"+(t+1)].machine=e[t].childNodes[s].firstChild.value)}this.fillEditCardPointsDiv(this.pointsData),this.backgroundPoints.style.display="none"}else this.backgroundPoints.style.display="none"};addAct=()=>{let s=this.perfActs.childNodes.length+1,n=document.createElement("div"),i=document.createElement("span"),a=document.createElement("input"),l=document.createElement("span");n.setAttribute("class","act-line"),i.setAttribute("class","perf-act"),i.setAttribute("id","perf-act"+t),i.textContent=s+":",a.setAttribute("type","text"),a.setAttribute("class","act-time"),a.setAttribute("id","act-time"+s),a.setAttribute("placeholder","1ч 15мин"),l.setAttribute("id","del-act-btn"+t),l.setAttribute("class","del-act-btn"),l.textContent="X",l.onclick=()=>{l.parentElement.remove()},n.appendChild(i),n.appendChild(a),n.appendChild(l),this.perfActs.insertBefore(n,this.perfActs.childNodes[e])};checkActs=()=>{let t=this.perfActs.childNodes.length,e=this.perfActs.childNodes;for(let s=0;s<t;s++)if(!e[s].childNodes[1].value)return e[s].childNodes[1].style.borderColor="red",e[s].childNodes[1].onclick=()=>e[s].childNodes[1].style.borderColor="initial",!1;return!0};inputsValid=()=>this.perfName.value?this.perfType.value?!!this.checkActs()||(this.perfActs.borderColor="red",!1):(this.perfType.style.borderColor="red",!1):(this.perfName.style.borderColor="red",!1);save=async(t,e)=>{if("update"===e||"create"===e){if(this.inputsValid()){let s=this.perfName.value,n=this.perfType.value,i=this.perfUrl.value,a=[],l=this.perfNotes.value;for(let t=0;t<this.perfActs.childNodes.length;t++){if(this.perfActs.childNodes[t].childNodes[1].value.includes(","))return this.perfActs.childNodes[t].childNodes[1].style.borderColor="red";a.push(this.perfActs.childNodes[t].childNodes[1].value)}if(t&&"update"===e){let o={name:s,type:n,imgUrl:i,acts:a,points:this.pointsData,notes:l,perfId:t,action:e};return"OK"==(await request("/performances","POST",o)).statusText?(alert("Спектакль обновлен успешно"),this.backgroundModal.style.display="none",void window.location.reload()):void alert("Ошибка во время сохранения")}if(!t&&"create"==e){let o={name:s,type:n,imgUrl:i,acts:a,points:this.pointsData,notes:l,perfId:t,action:e};if("OK"!=(await request("/performances","POST",o)).statusText)return void alert("Ошибка во время создания");alert("Новый спектакль успешно добавлен"),window.location.reload()}}}else if("remove"===e){let s={perfId:t,action:e};return"OK"==(await request("/performances","POST",s)).statusText?(alert("Спектакль успешно удалён"),void window.location.reload()):void alert("Ошибка удаления")}};addPoint=t=>{const e=document.createElement("tr"),s=document.createElement("span");s.textContent="/";for(let t=0;t<4;t++){let n=document.createElement("td");if(1==t)for(let t=0;t<2;t++){let e=document.createElement("input");e.setAttribute("type","number"),e.setAttribute("class","lines"),1==t&&n.appendChild(s),n.appendChild(e)}else if(2==t){let t=document.createElement("input");t.setAttribute("type","number"),t.setAttribute("class","meters"),n.appendChild(t)}else if(3==t){let t=document.createElement("input"),e=document.createElement("span");e.textContent="X",e.setAttribute("class","del-point-rope"),e.onclick=t=>{confirm("Удалить эту точку подвеса?")&&(t.target.parentElement.parentElement.remove(),this.totalPointsNum--,this.totalPointsSpan.textContent=this.totalPointsNum+" шт.")},t.setAttribute("type","number"),t.setAttribute("class","machine"),n.appendChild(t),n.appendChild(e)}e.appendChild(n)}e.setAttribute("class",t+"-point-rope"),document.getElementById(t+"-table").appendChild(e),this.totalPointsNum++,this.totalPointsSpan.textContent=this.totalPointsNum+" шт."}}class Repertuar{constructor(){this.rollLine=document.getElementById("event-container"),this.day=864e5,this.dt=new Date(Date.now());for(let t=0;t<5&&(this.todaySquare=document.getElementById(`${new Date(Date.now()).getMonth()}-${this.dt.getDate()}`),!this.todaySquare);t++)this.dt=new Date(this.dt.getTime()+this.day);this.target=this.todaySquare.offsetLeft-200,window.onload=()=>{this.startAnimatingScroll()}}startAnimatingScroll(){let t=1,e=setInterval(()=>{this.rollLine.scrollLeft<this.target?(t++,this.rollLine.scrollLeft+=500+10*t):clearInterval(e)},50)}}async function request(t,e,s){return await fetch(t,{method:e,headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})}
//# sourceMappingURL=maps/main.min.js.map
