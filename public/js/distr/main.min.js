function request(e,t,n,i){const l=new XMLHttpRequest;l.onreadystatechange=function(){4==this.readyState&&200==this.status?i("success",this):4==this.readyState&&500==this.status&&i("error",this)},l.onerror=function(e){0==e.currentTarget.status&&i("econn")},l.open(e,t,!0),!1!==n?(l.setRequestHeader("Content-type","application/x-www-form-urlencoded"),l.send(n)):l.send()}function Auth(){const e=this;this.authBt=document.getElementById("auth-bt"),this.login=document.getElementById("login"),this.pass=document.getElementById("pass"),this.authBt.onclick=function(){let t=e.login.value,n=e.pass.value;if(!t||!n)return alert("Отсутствует логин или пароль");request("POST","/auth",`login=${t}&pass=${n}`,(function(e,t){if("success"==e)return alert("Авторизация успешна и будет действительна в течение 30 дней"),window.location.href="/";"error"!=e||alert("Ошибка авторизации, проверьте введённые Вами данные")}))}}function Authenticate(){const e=this;this.login=document.getElementById("login"),this.pass1=document.getElementById("pass1"),this.pass2=document.getElementById("pass2"),this.authenBt=document.getElementById("authenticate-bt"),this.login.onclick=function(){e.login.style.borderColor="initial"},this.pass1.onclick=function(){e.pass1.style.borderColor="initial"},this.pass2.onclick=function(){e.pass2.style.borderColor="initial"},this.authenBt.onclick=function(){if(!e.login.value)return e.login.style.borderColor="red";if(!e.pass1.value)return e.pass1.style.borderColor="red";if(!e.pass2.value)return e.pass2.style.borderColor="red";let t=e.login.value,n=e.pass1.value,i=e.pass2.value,l=`login=${t}&pass1=${n}&pass2=${i}`;if(n!==i)return alert("Введённые пароли не совпадают");request("POST","/authenticate",l,(function(e,t){return"success"==e?(alert("Аутентификация успешна, сейчас вы будете перенаправлены на страницу логина"),window.location.href="/auth"):"error"==e?(console.log(t.statusText),void alert("Ошибка аутентификации, проверьте все поля")):void 0}))}}function updateBreadcrump(){const e=document.getElementById("bread-crump"),t=window.location.pathname;e.textContent={"/":"Главная","/materials":"Материалы","/performances":"Спектакли"}[t]}function Performance(){const e=this;this.pointsData={leftSide:{},rightSide:{}},this.totalPointsNum=0,this.addPerfBtn=document.getElementById("add-performance-btn"),this.preloader=document.getElementById("preloader"),this.searchInpt=document.getElementById("search-perfs"),this.backgroundModal=document.getElementById("background-modal"),this.closeAddPerf=document.getElementById("close-adding-perf"),this.savePerfBtn=document.getElementById("save-perf-btn"),this.perfName=document.getElementById("perf-name"),this.perfType=document.getElementById("perf-type"),this.perfUrl=document.getElementById("perf-pic-url"),this.perfActs=document.getElementById("perf-acts"),this.perfPoints=document.getElementById("perf-points"),this.perfNotes=document.getElementById("perf-notes"),this.addActBtn=document.getElementById("add-act"),this.searchResults=document.getElementById("search-results"),this.closeCardPerf=document.getElementById("close-card-perf"),this.backgroundCard=document.getElementById("card-back"),this.addPointsBtn=document.getElementById("add-points"),this.addRightPointBtn=document.getElementById("add-right-pt-btn"),this.addLeftPointBtn=document.getElementById("add-left-pt-btn"),this.backgroundPoints=document.getElementById("points-back"),this.closeEditPointsBtn=document.getElementById("close-points-perf"),this.userPointsBack=document.getElementById("user-points-back"),this.closeUserPoints=document.getElementById("close-user-points"),this.cardPerfName=document.getElementById("card-perf-name"),this.cardPerfImg=document.getElementById("card-perf-img"),this.cardPerfType=document.getElementById("card-perf-type"),this.cardPerfActs=document.getElementById("card-perf-acts"),this.cardPerfPoints=document.getElementById("card-perf-points"),this.cardPerfNotes=document.getElementById("card-perf-notes"),this.totalPointsSpan=document.getElementById("total-points-num"),this.getActsEnding=function(e){let t;return t=1==e?e+" акт":e>1&&e<5?e+" акта":e+"актов"},this.showPerformanceCard=function(){e.backgroundCard.style.display="block",window.scrollTo(0,0)},this.showUsualPointsTable=function(){e.userPointsBack.style.display="block",window.scrollTo(0,0)},this.fillCardPerformanceActs=function(t,n){const i=e.cardPerfType,l=e.cardPerfActs;"ballet"===t?i.textContent=`Балет, ${e.getActsEnding(n.length)}`:"opera"===t&&(i.textContent=`Опера, ${e.getActsEnding(n.length)}`),e.clearDomElement(l,(function(){for(let e=0;e<n.length;e++){let t=document.createElement("div"),i=document.createElement("span"),o=document.createElement("span");t.setAttribute("class","act-line"),i.textContent=`${e+1} Акт:`,o.textContent=`${n[e]}`,t.appendChild(i),t.appendChild(o),l.appendChild(t)}}))},this.fillCardPerformancePoints=function(t){const n=e.cardPerfPoints;if(t){2==n.childNodes.length?n.removeChild(n.childNodes[1]):3==n.childNodes.length&&(n.removeChild(n.childNodes[1]),n.removeChild(n.childNodes[1]));const i=document.createElement("p");i.setAttribute("class","total-points-usr"),i.textContent=`Всего: ${e.countPointsNum(t)} шт.`,n.appendChild(i),e.fillUserPointsTable(t);const l=document.createElement("button");l.setAttribute("class","showPoints-btn"),l.textContent="Просмотр",l.onclick=function(){let t=e.userPointsBack,n=e.backgroundCard;t.style.height=n.offsetHeight+"px",e.showUsualPointsTable()},n.appendChild(l)}else if(3==n.childNodes.length){n.removeChild(n.childNodes[1]),n.removeChild(n.childNodes[1]);const e=document.createElement("i");e.textContent="– Отсутствуют",n.appendChild(e)}},this.fillPerformanceCard=function(t){const n=e.cardPerfName,i=e.cardPerfImg,l=e.cardPerfNotes;if(n.textContent=t.name,t.imgUrl?(i.src="/static/imgs/performance-imgs/"+t.imgUrl,i.style.display="inline-block"):(i.src="/static/imgs/performance-imgs/no-photo.png",i.style.display="inline-block"),e.fillCardPerformanceActs(t.type,t.acts),e.fillCardPerformancePoints(t.points),""!=t.notes?l.innerHTML=t.notes:l.textContent="– Отсутствуют","true"===admin){let i=document.createElement("button");i.setAttribute("class","edit-btn"),i.textContent="Редактировать",i.onclick=function(){e.openEdit(t)};let l=document.createElement("button");l.setAttribute("class","rm-perf-btn"),l.textContent="Удалить",l.onclick=function(){confirm(`Вы действительно хотите удалить спектакль "${t.name}" из базы?`)&&e.save(t._id,"remove")},5==n.parentElement.childNodes.length?(n.parentElement.appendChild(i),n.parentElement.appendChild(l)):(n.parentElement.childNodes[5].remove(),n.parentElement.childNodes[5].remove(),n.parentElement.appendChild(i),n.parentElement.appendChild(l))}e.savePerfBtn.onclick=function(){e.save(t._id,"update")}},this.clearDomElement=function(e,t){for(;e.firstChild;)e.removeChild(e.firstChild);return t()},this.fillSearchResults=function(t){const n=e.searchResults;if(0==t.length){const e=document.createElement("div");e.setAttribute("class","perf-name-found nothing-found"),e.textContent="Ничего не найдено",n.childNodes[0]||n.appendChild(e)}else for(let i=0;i<t.length;i++){let l=document.createElement("div");l.setAttribute("class","perf-name-found"),l.textContent=t[i].name,l.onclick=function(){e.fillPerformanceCard(t[i]),e.showPerformanceCard()};for(let e=0;e<n.childNodes.length;e++)if(n.childNodes[e].textContent==l.textContent)return;n.appendChild(l)}},this.searchInpt.oninput=function(){e.searchInpt.value&&""!=e.searchInpt.value?e.clearDomElement(e.searchResults,(function(){const t=e.searchInpt.value;if(!/^\s*$/.test(t)&&!/^\.+/.test(t)){const n=`query=${t}`;e.preloader.style.display="block",request("POST","/perf-search",n,(function(t,n){if("success"===t){const t=JSON.parse(n.responseText).perfs;e.fillSearchResults(t),e.preloader.style.display="none"}else{if("error"==t)return void(e.preloader.style.display="none");if("econn"==t){e.preloader.style.display="none";const t=document.createElement("div");t.setAttribute("class","perf-name-found nothing-found"),t.textContent="Проверьте интернет соединение",e.searchResults.childNodes[0]||e.searchResults.appendChild(t)}}}))}})):setTimeout((function(){e.clearDomElement(e.searchResults,(function(){}))}),100)},this.openEdit=function(t){if(e.pointsData=t.points,e.backgroundCard.style.display="none",e.backgroundModal.style.display="block",this.perfName.value=t.name,this.perfType.value=t.type,this.perfUrl.value=t.imgUrl,t.acts.length>0){let n,i,l,o,s;this.perfActs.innerHTML="";for(let d=0;d<t.acts.length;d++)(n=document.createElement("actLine")).setAttribute("class","act-line"),(i=document.createElement("span")).setAttribute("class","perf-act"),i.textContent=d+1+":",n.appendChild(i),(l=document.createElement("input")).setAttribute("class","act-time"),l.setAttribute("type","text"),l.setAttribute("placeholder","1ч 15мин"),l.value=t.acts[d],n.appendChild(l),0==d?((s=document.createElement("button")).setAttribute("class","add-mini-btn"),s.textContent="+",s.onclick=function(){e.addAct()},n.appendChild(s)):((o=document.createElement("span")).setAttribute("class","del-act-btn"),o.textContent="X",o.onclick=function(e){e.target.parentElement.remove()},n.appendChild(o)),em=document.createElement("button"),i.setAttribute("class","perf-act"),this.perfActs.appendChild(n)}e.fillEditCardPointsDiv(t.points),e.fillPointsEditModal(t.points),this.perfNotes.value=t.notes,this.savePerfBtn.textContent="Сохранить изменения",this.savePerfBtn.onclick=function(){e.save(t._id,"update")}},this.fillEditCardPointsDiv=function(t){if(t){e.perfPoints.childNodes[0].remove(),e.perfPoints.childNodes[0].remove();let n=document.createElement("span");n.setAttribute("class","points-number"),n.textContent=e.countPointsNum(t)+" шт.";let i=document.createElement("span");i.setAttribute("class","showPoints-btn"),i.textContent="Редактор",i.onclick=function(){e.fillPointsEditModal(t),e.backgroundPoints.style.height=e.backgroundModal.offsetHeight+"px",e.backgroundPoints.style.display="block",window.scrollTo(0,0)},e.perfPoints.appendChild(n),e.perfPoints.appendChild(i)}},this.isEmpty=function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return JSON.stringify(e)===JSON.stringify({})},this.fillPointsEditModal=function(t){t||(t={});let n=document.getElementById("left-table"),i=document.getElementById("right-table");for(;1!=n.childNodes.length;)n.childNodes[n.childNodes.length-1].remove();for(;1!=i.childNodes.length;)i.childNodes[i.childNodes.length-1].remove();e.totalPointsNum=e.countPointsNum(t);let l,o,s,d,r,a=document.getElementById("total-points-num");for(key1 in a.textContent=e.countPointsNum(t)+" шт.",t.leftSide){if(e.isEmpty(t.leftSide[key1]))continue;let i,o,a;(l=document.createElement("tr")).setAttribute("class","left-point-rope"),l.appendChild(document.createElement("td")),s=document.createElement("td"),d=document.createElement("td"),r=document.createElement("td"),(i=document.createElement("input")).setAttribute("type","number"),i.setAttribute("class","lines"),i.value=t.leftSide[key1].stalls.split("/")[0],(o=document.createElement("span")).textContent="/",(a=document.createElement("input")).setAttribute("type","number"),a.setAttribute("class","lines"),a.value=t.leftSide[key1].stalls.split("/")[1],s.appendChild(i),s.appendChild(o),s.appendChild(a);let c=document.createElement("input");c.setAttribute("type","number"),c.setAttribute("class","meters"),c.value=t.leftSide[key1].meters,d.appendChild(c);let u=document.createElement("input");u.setAttribute("type","number"),u.setAttribute("class","machine"),u.value=t.leftSide[key1].machine,r.appendChild(u);let p=document.createElement("span");p.setAttribute("class","del-point-rope"),p.textContent="X",p.onclick=function(t){confirm("Удалить эту точку подвеса?")&&(t.target.parentElement.parentElement.remove(),e.totalPointsNum--,e.totalPointsSpan.textContent=e.totalPointsNum+" шт.")},r.appendChild(p),l.appendChild(s),l.appendChild(d),l.appendChild(r),n.appendChild(l)}for(key2 in t.rightSide){if(e.isEmpty(t.rightSide[key2]))continue;let n,l,a;(o=document.createElement("tr")).setAttribute("class","right-point-rope"),o.appendChild(document.createElement("td")),s=document.createElement("td"),d=document.createElement("td"),r=document.createElement("td"),(n=document.createElement("input")).setAttribute("type","number"),n.setAttribute("class","lines"),n.value=t.rightSide[key2].stalls.split("/")[0],(l=document.createElement("span")).textContent="/",(a=document.createElement("input")).setAttribute("type","number"),a.setAttribute("class","lines"),a.value=t.rightSide[key2].stalls.split("/")[1],s.appendChild(n),s.appendChild(l),s.appendChild(a);let c=document.createElement("input");c.setAttribute("type","number"),c.setAttribute("class","meters"),c.value=t.rightSide[key2].meters,d.appendChild(c);let u=document.createElement("input");u.setAttribute("type","number"),u.setAttribute("class","machine"),u.value=t.rightSide[key2].machine,r.appendChild(u);let p=document.createElement("span");p.setAttribute("class","del-point-rope"),p.textContent="X",p.onclick=function(t){confirm("Удалить эту точку подвеса?")&&(t.target.parentElement.parentElement.remove(),e.totalPointsNum--,e.totalPointsSpan.textContent=e.totalPointsNum+" шт.")},r.appendChild(p),o.appendChild(s),o.appendChild(d),o.appendChild(r),i.appendChild(o)}},this.countPointsNum=function(t){let n=0;if(!t)return 0;for(key1 in t.leftSide)e.isEmpty(t.leftSide[key1])||n++;for(key1 in t.rightSide)e.isEmpty(t.rightSide[key1])||n++;return n},this.closeUserPoints.onclick=function(){e.userPointsBack.style.display="none"},this.fillUserPointsTable=function(t){let n=document.getElementById("left-usr-table"),i=document.getElementById("right-usr-table");for(;n.childNodes[1];)n.childNodes[1].remove();for(;i.childNodes[1];)i.childNodes[1].remove();let l,o,s,d,r,a=document.getElementById("total-user-points");for(key1 in a.textContent=e.countPointsNum(t)+" шт.",t.leftSide)(l=document.createElement("tr")).appendChild(document.createElement("td")),s=document.createElement("td"),d=document.createElement("td"),r=document.createElement("td"),s.textContent=t.leftSide[key1].stalls,l.appendChild(s),d.textContent=t.leftSide[key1].meters,l.appendChild(d),r.textContent=t.leftSide[key1].machine,l.appendChild(r),n.appendChild(l);for(key2 in t.rightSide)(o=document.createElement("tr")).appendChild(document.createElement("td")),s=document.createElement("td"),d=document.createElement("td"),r=document.createElement("td"),s.textContent=t.rightSide[key2].stalls,o.appendChild(s),d.textContent=t.rightSide[key2].meters,o.appendChild(d),r.textContent=t.rightSide[key2].machine,o.appendChild(r),i.appendChild(o)},this.saveEditingPoints=function(){let t=document.getElementsByClassName("left-point-rope"),n=document.getElementsByClassName("right-point-rope");if(e.pointsData={leftSide:{},rightSide:{}},0!=t.length||0!=n.length){for(let n=0;n<t.length;n++){e.pointsData.leftSide["point"+(n+1)]={};for(let i=1;i<t[n].childNodes.length;i++)if(1==i){let l=t[n].childNodes[i].firstChild,o=t[n].childNodes[i].lastChild;if(!l.value)return l.parentElement.style.backgroundColor="red",l.onclick=function(){l.parentElement.style.backgroundColor="initial"},void alert("Пустые поля недопустимы, заполните либо удалите пустые точки подвеса");if(!o.value)return o.parentElement.style.backgroundColor="red",o.onclick=function(){o.parentElement.style.backgroundColor="initial"},void alert("Пустые поля недопустимы, заполните либо удалите пустые точки подвеса");e.pointsData.leftSide["point"+(n+1)].stalls=l.value+"/"+o.value}else if(2==i){if(!t[n].childNodes[i].firstChild.value)return t[n].childNodes[i].firstChild.parentElement.style.backgroundColor="red",t[n].childNodes[i].firstChild.onclick=function(){t[n].childNodes[i].firstChild.parentElement.style.backgroundColor="initial"},void alert("Пустые поля недопустимы, заполните либо удалите пустые точки подвеса");e.pointsData.leftSide["point"+(n+1)].meters=t[n].childNodes[i].firstChild.value}else 3==i&&(e.pointsData.leftSide["point"+(n+1)].machine=t[n].childNodes[i].firstChild.value)}for(let t=0;t<n.length;t++){e.pointsData.rightSide["point"+(t+1)]={};for(let i=1;i<n[t].childNodes.length;i++)if(1==i){let l=n[t].childNodes[i].firstChild,o=n[t].childNodes[i].lastChild;if(!l.value)return l.parentElement.style.backgroundColor="red",l.onclick=function(){l.parentElement.style.backgroundColor="initial"},void alert("Пустые поля недопустимы, заполните либо удалите пустые точки подвеса");if(!o.value)return o.parentElement.style.backgroundColor="red",o.onclick=function(){o.parentElement.style.backgroundColor="initial"},void alert("Пустые поля недопустимы, заполните либо удалите пустые точки подвеса");e.pointsData.rightSide["point"+(t+1)].stalls=l.value+"/"+o.value}else if(2==i){if(!n[t].childNodes[i].firstChild.value)return n[t].childNodes[i].firstChild.parentElement.style.backgroundColor="red",n[t].childNodes[i].firstChild.onclick=function(){n[t].childNodes[i].firstChild.parentElement.style.backgroundColor="initial"},void alert("Пустые поля недопустимы, заполните либо удалите пустые точки подвеса");e.pointsData.rightSide["point"+(t+1)].meters=n[t].childNodes[i].firstChild.value}else 3==i&&(e.pointsData.rightSide["point"+(t+1)].machine=n[t].childNodes[i].firstChild.value)}e.fillEditCardPointsDiv(e.pointsData),e.backgroundPoints.style.display="none"}else e.backgroundPoints.style.display="none"},this.closeEditPointsBtn.onclick=function(){e.saveEditingPoints()},this.addPointsBtn.onclick=function(){e.backgroundPoints.style.display="block",window.scrollTo(0,0)},this.closeCardPerf.onclick=function(){e.savePerfBtn.onclick=function(){e.save(!1,"create")},e.backgroundCard.style.display="none"},"true"===admin&&(this.addPerfBtn.onclick=function(){e.backgroundModal.style.display="block"}),this.closeAddPerf.onclick=function(){e.backgroundModal.style.display="none"},this.savePerfBtn.onclick=function(){e.save(!1,"create")},this.perfName.onclick=function(){e.perfName.style.borderColor="initial"},this.perfType.onclick=function(){e.perfType.style.borderColor="initial"},this.addActBtn.onclick=function(){e.addAct()},this.addRightPointBtn.onclick=function(){e.addPoint("right")},this.addLeftPointBtn.onclick=function(){e.addPoint("left")},this.addAct=function(){let t=e.perfActs.childNodes.length,n=t+1,i=document.createElement("div"),l=document.createElement("span"),o=document.createElement("input"),s=document.createElement("span");i.setAttribute("class","act-line"),l.setAttribute("class","perf-act"),l.setAttribute("id","perf-act"+n),l.textContent=n+":",o.setAttribute("type","text"),o.setAttribute("class","act-time"),o.setAttribute("id","act-time"+n),o.setAttribute("placeholder","1ч 15мин"),s.setAttribute("id","del-act-btn"+n),s.setAttribute("class","del-act-btn"),s.textContent="X",s.onclick=function(){s.parentElement.remove()},i.appendChild(l),i.appendChild(o),i.appendChild(s),e.perfActs.insertBefore(i,e.perfActs.childNodes[t])},this.checkActs=function(){let t=e.perfActs.childNodes.length,n=e.perfActs.childNodes;for(let e=0;e<t;e++)if(!n[e].childNodes[1].value)return n[e].childNodes[1].style.borderColor="red",n[e].childNodes[1].onclick=function(){return n[e].childNodes[1].style.borderColor="initial"},!1;return!0},this.inputsValid=function(){return e.perfName.value?e.perfType.value?!!e.checkActs()||(e.perfActs.borderColor="red",!1):(e.perfType.style.borderColor="red",!1):(e.perfName.style.borderColor="red",!1)},this.save=function(t,n){if("update"===n||"create"===n){if(e.inputsValid()){let i=e.perfName.value,l=e.perfType.value,o=e.perfUrl.value,s=[],d=e.perfNotes.value;for(let t=0;t<e.perfActs.childNodes.length;t++){if(e.perfActs.childNodes[t].childNodes[1].value.includes(","))return void(e.perfActs.childNodes[t].childNodes[1].style.borderColor="red");s.push(e.perfActs.childNodes[t].childNodes[1].value)}if(t&&"update"===n){request("post","/performances",`name=${i}&type=${l}&imgUrl=${o}&acts=${s}&points=${JSON.stringify(e.pointsData)}&notes=${d}&perfId=${t}&action=${n}`,(function(t,n){if("success"==t)alert("Спектакль обновлен успешно"),e.backgroundModal.style.display="none",window.location.reload();else if("err"==t)return}))}else if(!t&&"create"==n){request("post","/performances",`name=${i}&type=${l}&imgUrl=${o}&acts=${s}&points=${JSON.stringify(e.pointsData)}&notes=${d}&action=${n}`,(function(t,n){if("success"==t)alert("Новый спектакль успешно добавлен"),e.backgroundModal.style.display="none",window.location.reload();else if("err"==t)return}))}}}else"remove"===n&&(perfData=`perfId=${t}&action=${n}`,request("post","/performances",perfData,(function(t,n){if("success"==t)alert("Спектакль успешно удалён"),e.backgroundModal.style.display="none",window.location.reload();else if("err"==t)return})))},this.addPoint=function(t){let n=document.createElement("tr"),i=document.createElement("span");i.textContent="/";for(let t=0;t<4;t++){let l=document.createElement("td");if(1==t)for(let e=0;e<2;e++){let t=document.createElement("input");t.setAttribute("type","number"),t.setAttribute("class","lines"),1==e&&l.appendChild(i),l.appendChild(t)}else if(2==t){let e=document.createElement("input");e.setAttribute("type","number"),e.setAttribute("class","meters"),l.appendChild(e)}else if(3==t){let t=document.createElement("input"),n=document.createElement("span");n.textContent="X",n.setAttribute("class","del-point-rope"),n.onclick=function(t){confirm("Удалить эту точку подвеса?")&&(t.target.parentElement.parentElement.remove(),e.totalPointsNum--,e.totalPointsSpan.textContent=e.totalPointsNum+" шт.")},t.setAttribute("type","number"),t.setAttribute("class","machine"),l.appendChild(t),l.appendChild(n)}n.appendChild(l)}n.setAttribute("class",t+"-point-rope"),document.getElementById(t+"-table").appendChild(n),e.totalPointsNum++,e.totalPointsSpan.textContent=e.totalPointsNum+" шт."}}function SkedApp(){const e=this,t=["Вс","Пн","Вт","Ср","Чт","Пт","Сб"];this.init=function(){document.getElementById("new-sked").addEventListener("click",(function(){e.new()}));const n=document.getElementsByClassName("weekdate"),i=new Date(Date.now()),l=i.getDate(),o=i.getDay();request("POST","/sked",`year=${i.getFullYear()}&month=${i.getMonth()}`,(function(e,i){if("success"==e){const e=JSON.parse(i.responseText);let s=l-1,d=o;for(let i=0;i<n.length;i++)n[i].textContent=e[s].date+" "+t[d],s++,d<7?d++:d=0}else if("error"==e)return}))},this.new=function(){}}
//# sourceMappingURL=maps/main.min.js.map
