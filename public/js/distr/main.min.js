class Authenticate{constructor(){this.login=document.getElementById("login"),this.pass1=document.getElementById("pass1"),this.pass2=document.getElementById("pass2"),this.authBtn=document.getElementById("authenticate-bt"),this.login.onclick=()=>{this.login.style.borderColor="transparent"},this.pass1.onclick=()=>{this.pass1.style.borderColor="transparent"},this.pass2.onclick=()=>{this.pass2.style.borderColor="transparent"},this.authBtn.onclick=()=>{this.authenticate()}}async authenticate(){if(!this.login.value)return alert('Поле "Логин" пусто. Придумайте себе логин, чтобы продолжить.'),void(this.login.style.borderColor="#f26a6a");if(!this.pass1.value)return alert('Поле "Пароль" пусто. Придумайте себе пароль, чтобы продолжить.'),void(this.pass1.style.borderColor="#f26a6a");if(!this.pass2.value)return alert('Поле "Пароль повторно" пусто. Введите пароль повторно, чтобы продолжить.'),void(this.pass2.style.borderColor="#f26a6a");if(this.pass1.value!==this.pass2.value)return void alert("Введённые Вами пароли не совпадают");const t={login:this.login.value,pass1:this.pass1.value,pass2:this.pass2.value},e=await request("/authenticate","POST",t);if("Inconsistent data"!=e.statusText)return"Duplicate"==e.statusText?void alert("Такой логин уже занят, придумайте другой"):"Passwords mismatch"==e.statusText?void alert("Пароли не совпадают"):"Authenticated"==e.statusText?(alert("Аутентификация успешна, сейчас вы будете перенаправлены на страницу логина"),void(window.location.href="/auth")):void alert("Ошибка аутентификации");alert("Отсутсвует логин или пароль")}}class Authorisate{constructor(){this.authBtn=document.getElementById("auth-bt"),this.loginInpt=document.getElementById("login"),this.passInpt=document.getElementById("pass"),this.authBtn.onclick=()=>{this.authorise()}}async authorise(){if(!this.loginInpt.value||!this.passInpt.value)return alert("Отсутствует логин или пароль");const t={login:this.loginInpt.value,pass:this.passInpt.value},e=await request("/auth","POST",t);return"Check login and password"==e.statusText?void alert("Неверный логин или пароль"):"Authorised"==e.statusText?(alert("Авторизация успешна и будет действительна в течение 30 дней"),void(window.location.href="/performances")):void alert("Произошла ошибка во время авторизации")}}class Calendars{constructor(){this.stageEvTime=document.getElementById("stage-ev-time"),this.stageEvMsg=document.getElementById("stage-ev-msg"),this.tehEvTime=document.getElementById("teh-ev-time"),this.tehEvMsg=document.getElementById("teh-ev-msg"),this.loadEvTime=document.getElementById("load-ev-time"),this.loadEvMsg=document.getElementById("load-ev-msg"),this.stagePreloader=document.getElementById("stage-preloader"),this.tehPreloader=document.getElementById("teh-preloader"),this.loadPreloader=document.getElementById("load-preloader"),this.stageEvURL="/api/ical/stage",this.tehEvURL="/api/ical/teh-job",this.loadEvURL="/api/ical/load",window.onload=()=>{this.updateAllEvents()}}showTehPreloader(){this.tehPreloader.style.display="block"}showStagePreloader(){this.stagePreloader.style.display="block"}showLoadPreloader(){this.loadPreloader.style.display="block"}hideTehPreloader(){this.tehPreloader.style.display="none"}hideLoadPreloader(){this.loadPreloader.style.display="none"}hideStagePreloader(){this.stagePreloader.style.display="none"}async getCalEvents(t){const e=await request(t,"GET");200!==e.status&&console.error("Error uploading calendar events");return(await e.json()).evts}getTodayEvents(t){const e=new Date(Date.now()),s=e.getDate(),n=e.getMonth(),i=e.getFullYear(),a=[];for(let e in t){const l=new Date(t[e].start);l.getFullYear()==i&&l.getMonth()==n&&l.getDate()==s&&a.push(t[e])}return a}getCurrentEvent(t){const e=new Date(Date.now());for(let s=0;s<t.length;s++){const n=new Date(t[s].start).getTime(),i=new Date(t[s].end).getTime(),a=e.getTime();if(n<a&&i>a)return t[s]}return{summary:"Нет данных"}}async updateAllEvents(){this.showStagePreloader();const t=await this.getCalEvents(this.stageEvURL);this.showTehPreloader();const e=await this.getCalEvents(this.tehEvURL);this.showLoadPreloader();const s=await this.getCalEvents(this.loadEvURL),n=this.getTodayEvents(t),i=this.getCurrentEvent(n);this.setStageEvent(i),this.hideStagePreloader();const a=this.getTodayEvents(e),l=this.getCurrentEvent(a);this.setTehEvent(l),this.hideTehPreloader();const r=this.getTodayEvents(s),o=this.getCurrentEvent(r);this.setLoadEvent(o),this.hideLoadPreloader()}setStageEvent(t){this.stageEvMsg.textContent=t.summary,t.start&&t.end?this.stageEvTime.textContent="Сейчас: "+this.getRusTime(t.start)+" - "+this.getRusTime(t.end):this.stageEvTime.textContent="Сейчас: "}setTehEvent(t){this.tehEvMsg.textContent=t.summary,t.start&&t.end?this.tehEvTime.textContent="Сейчас: "+this.getRusTime(t.start)+" - "+this.getRusTime(t.end):this.stageEvTime.textContent="Сейчас: "}setLoadEvent(t){this.loadEvMsg.textContent=t.summary,t.start&&t.end?this.loadEvTime.textContent="Сейчас: "+this.getRusTime(t.start)+" - "+this.getRusTime(t.end):this.stageEvTime.textContent="Сейчас: "}getRusTime(t){let e=(t=new Date(t)).getHours(),s=t.getMinutes();return 1==s.toString().length&&(s=s.toString()+"0"),e+=":"+s,e}}class iCal{constructor(){this.intId=null,this.nowOnStage=document.getElementById("now-on-stage"),window.onload=()=>{this.startPreloader(),this.startUpdatingStageEvents()}}startUpdatingStageEvents(){this.updateStageEvent(),setInterval(()=>{this.updateStageEvent()},6e4)}async updateStageEvent(){const t=await this.getCalEvents(),e=this.getCurrMonthEvents(t),s=this.getTodayEvents(e),n=this.getCurrEvent(s);this.setEvent(n)}async getCalEvents(){const t=await request("/api/ical/stage","GET");200!==t.status&&(clearInterval(this.intId),this.nowOnStage.textContent="? error ?");return(await t.json()).evts}getCurrYearEvents(t){const e=new Date(Date.now()),s=e.getFullYear(),n=(e.getMonth(),[]);for(let e in t){new Date(t[e].start).getFullYear()==s&&n.push(t[e])}return n}getCurrMonthEvents(t){const e=new Date(Date.now()),s=e.getFullYear(),n=e.getMonth(),i=[];for(let e in t){const a=new Date(t[e].start);a.getFullYear()==s&&a.getMonth()==n&&i.push(t[e])}return i}getTodayEvents(t){const e=new Date(Date.now()),s=[];for(let n=0;n<t.length;n++)new Date(t[n].start).getDate()==e.getDate()&&s.push(t[n]);return s}getCurrEvent(t){const e=new Date(Date.now());for(let s=0;s<t.length;s++){const n=new Date(t[s].start).getTime(),i=new Date(t[s].end).getTime(),a=e.getTime();if(n<a&&i>a)return t[s]}return{summary:"Нет данных"}}getRusTime(t){let e=(t=new Date(t)).getHours(),s=t.getMinutes();return 1==s.toString().length&&(s=s.toString()+"0"),e+=":"+s,e}setEvent(t){if(clearInterval(this.intId),t&&"Hичего"!=t.summary){const e=new Date(t.start),s=new Date(t.end),n="C "+this.getRusTime(e)+" до "+this.getRusTime(s);this.nowOnStage.textContent=n+" - "+t.summary}else this.nowOnStage.textContent=t.summary}startPreloader(){let t=".";this.intId=setInterval(()=>{t+=".",this.nowOnStage.textContent=t,t.length>2&&(t="")},500)}}class Performance{constructor(t="",e="false"){this.edit=e,this.pointsData={leftSide:{},rightSide:{}},this.totalPointsNum=0,this.addPerfBtn=document.getElementById("add-performance-btn"),this.preloader=document.getElementById("preloader"),this.searchInpt=document.getElementById("search-perfs"),this.backgroundModal=document.getElementById("background-modal"),this.closeAddPerf=document.getElementById("close-adding-perf"),this.savePerfBtn=document.getElementById("save-perf-btn"),this.perfName=document.getElementById("perf-name"),this.perfType=document.getElementById("perf-type"),this.perfUrl=document.getElementById("perf-pic-url"),this.perfActs=document.getElementById("perf-acts"),this.perfPoints=document.getElementById("perf-points"),this.perfNotes=document.getElementById("perf-notes"),this.addActBtn=document.getElementById("add-act"),this.searchResults=document.getElementById("search-results"),this.closeCardPerf=document.getElementById("close-card-perf"),this.backgroundCard=document.getElementById("card-back"),this.addPointsBtn=document.getElementById("add-points"),this.addRightPointBtn=document.getElementById("add-right-pt-btn"),this.addLeftPointBtn=document.getElementById("add-left-pt-btn"),this.backgroundPoints=document.getElementById("points-back"),this.closeEditPointsBtn=document.getElementById("close-points-perf"),this.userPointsBack=document.getElementById("user-points-back"),this.closeUserPoints=document.getElementById("close-user-points"),this.cardPerfName=document.getElementById("card-perf-name"),this.cardPerfImg=document.getElementById("card-perf-img"),this.cardPerfType=document.getElementById("card-perf-type"),this.cardPerfActs=document.getElementById("card-perf-acts"),this.cardPerfPoints=document.getElementById("card-perf-points"),this.cardPerfNotes=document.getElementById("card-perf-notes"),this.totalPointsSpan=document.getElementById("total-points-num"),"true"===this.edit&&(this.addPerfBtn.onclick=()=>{this.backgroundModal.style.display="block"},this.closeAddPerf.onclick=()=>{this.backgroundModal.style.display="none"},this.savePerfBtn.onclick=()=>{this.save(!1,"create")},this.perfName.onclick=()=>{this.perfName.style.borderColor="initial"},this.perfType.onclick=()=>{this.perfType.style.borderColor="initial"},this.addActBtn.onclick=()=>{this.addAct()},this.addRightPointBtn.onclick=()=>{this.addPoint("right")},this.addLeftPointBtn.onclick=()=>{this.addPoint("left")}),this.closeEditPointsBtn.onclick=()=>{this.saveEditingPoints()},this.addPointsBtn.onclick=()=>{this.backgroundPoints.style.display="block",window.scrollTo(0,0)},this.closeCardPerf.onclick=()=>{this.savePerfBtn.onclick=()=>{this.save(!1,"create")},this.backgroundCard.style.display="none"},this.closeUserPoints.onclick=()=>{this.userPointsBack.style.display="none"},this.searchInpt.oninput=()=>{this.searchInpt.value&&""!=this.searchInpt.value?this.clearDomElement(this.searchResults,async()=>{if(/^\s*$/.test(this.searchInpt.value))this.fillSearchResults([]);else{const t={query:this.searchInpt.value};this.preloader.style.display="block";const e=await request("/perf-search","POST",t);if("OK"==e.statusText){const t=await e.json();this.fillSearchResults(t.perfs),this.preloader.style.display="none"}else{if("error"===e)return this.preloader.style.display="none";if("econn"==e){this.preloader.style.display="none";const t=document.createElement("div");t.setAttribute("class","perf-name-found nothing-found"),t.textContent="Проверьте интернет соединение",this.searchResults.childNodes[0]||this.searchResults.appendChild(t)}}}}):setTimeout(()=>{this.clearDomElement(this.searchResults,()=>{})},100)}}getActsEnding=t=>1==t?t+" акт":t>1&&t<5?t+" акта":t+"актов";showPerformanceCard=()=>{this.backgroundCard.style.display="block",window.scrollTo(0,0)};showUsualPointsTable=()=>{this.userPointsBack.style.display="block",window.scrollTo(0,0)};clearDomElement=(t,e)=>{for(;t.firstChild;)t.firstChild.remove();return e()};fillCardPerformanceActs=(t,e)=>{"ballet"===t?this.cardPerfType.textContent="Балет, "+this.getActsEnding(e.length):"opera"===t&&(this.cardPerfType.textContent="Опера, "+this.getActsEnding(e.length)),this.clearDomElement(this.cardPerfActs,()=>{for(let t=0;t<e.length;t++){let s=document.createElement("div"),n=document.createElement("span"),i=document.createElement("span");s.setAttribute("class","act-line"),n.textContent=t+1+" Акт:",i.textContent=""+e[t],s.appendChild(n),s.appendChild(i),this.cardPerfActs.appendChild(s)}})};fillCardPerformancePoints=t=>{if(t){2==this.cardPerfPoints.childNodes.length?this.cardPerfPoints.childNodes[1].remove():3==this.cardPerfPoints.childNodes.length&&(this.cardPerfPoints.childNodes[1].remove(),this.cardPerfPoints.childNodes[1].remove());const e=document.createElement("p");e.setAttribute("class","total-points-usr"),e.textContent=`Всего: ${this.countPointsNum(t)} шт.`,this.cardPerfPoints.appendChild(e),this.fillUserPointsTable(t);const s=document.createElement("button");s.setAttribute("class","showPoints-btn"),s.textContent="Просмотр",s.onclick=()=>{this.userPointsBack.style.height=this.backgroundCard.offsetHeight+"px",this.showUsualPointsTable()},this.cardPerfPoints.appendChild(s)}else if(3==this.cardPerfPoints.childNodes.length){this.cardPerfPoints.childNodes[1].remove(),this.cardPerfPoints.childNodes[1].remove();const t=document.createElement("i");t.textContent="– Отсутствуют",this.cardPerfPoints.appendChild(t)}};fillPerformanceCard=t=>{if(this.cardPerfName.textContent=t.name,t.imgUrl?(this.cardPerfImg.src=window.location.origin+"/static/imgs/performance-imgs/"+t.imgUrl,this.cardPerfImg.style.display="inline-block"):(this.cardPerfImg.src=window.location.origin+"/static/imgs/performance-imgs/no-photo.png",this.cardPerfImg.style.display="inline-block"),this.fillCardPerformanceActs(t.type,t.acts),this.fillCardPerformancePoints(t.points),""!=t.notes?this.cardPerfNotes.innerHTML=t.notes:this.cardPerfNotes.textContent="– Отсутствуют","true"===this.edit){let e=document.createElement("button");e.setAttribute("class","edit-btn"),e.textContent="Редактировать",e.onclick=()=>{this.openEdit(t)};let s=document.createElement("button");s.setAttribute("class","rm-perf-btn"),s.textContent="Удалить",s.onclick=()=>{confirm(`Вы действительно хотите удалить спектакль "${t.name}" из базы?`)&&this.save(t._id,"remove")},4==this.cardPerfName.parentElement.childNodes.length?(this.cardPerfName.parentElement.appendChild(e),this.cardPerfName.parentElement.appendChild(s)):(this.cardPerfName.parentElement.childNodes[4].remove(),this.cardPerfName.parentElement.childNodes[4].remove(),this.cardPerfName.parentElement.appendChild(e),this.cardPerfName.parentElement.appendChild(s))}this.savePerfBtn.onclick=()=>{this.save(t._id,"update")}};fillSearchResults=t=>{if(0==t.length){const t=document.createElement("div");t.setAttribute("class","perf-name-found nothing-found"),t.textContent="Ничего не найдено",this.searchResults.childNodes[0]||this.searchResults.appendChild(t)}else for(let e=0;e<t.length;e++){let s=document.createElement("div");s.setAttribute("class","perf-name-found"),s.textContent=t[e].name,s.onclick=()=>{this.fillPerformanceCard(t[e]),this.showPerformanceCard()};for(let t=0;t<this.searchResults.childNodes.length;t++)if(this.searchResults.childNodes[t].textContent==s.textContent)return;this.searchResults.appendChild(s)}};openEdit=t=>{if(this.pointsData=t.points,this.backgroundCard.style.display="none",this.backgroundModal.style.display="block",this.perfName.value=t.name,this.perfType.value=t.type,this.perfUrl.value=t.imgUrl,t.acts.length>0){let e,s,n,i,a;this.perfActs.innerHTML="";for(let l=0;l<t.acts.length;l++)e=document.createElement("div"),e.setAttribute("class","act-line"),s=document.createElement("span"),s.setAttribute("class","perf-act"),s.textContent=l+1+":",e.appendChild(s),n=document.createElement("input"),n.setAttribute("class","act-time"),n.setAttribute("type","text"),n.setAttribute("placeholder","1ч 15мин"),n.value=t.acts[l],e.appendChild(n),0==l?(a=document.createElement("button"),a.setAttribute("class","add-mini-btn"),a.textContent="+",a.onclick=()=>{this.addAct()},e.appendChild(a)):(i=document.createElement("span"),i.setAttribute("class","del-act-btn"),i.textContent="X",i.onclick=t=>{t.target.parentElement.remove()},e.appendChild(i)),this.perfActs.appendChild(e);this.fillEditCardPointsDiv(t.points),this.fillPointsEditModal(t.points),this.perfNotes.value=t.notes,this.savePerfBtn.textContent="Сохранить изменения",this.savePerfBtn.onclick=()=>{this.save(t._id,"update")}}};fillEditCardPointsDiv=t=>{if(t){this.perfPoints.childNodes[0].remove(),this.perfPoints.childNodes[0].remove();let e=document.createElement("span");e.setAttribute("class","points-number"),e.textContent=this.countPointsNum(t)+" шт.";let s=document.createElement("span");s.setAttribute("class","showPoints-btn"),s.textContent="Редактор",s.onclick=()=>{this.fillPointsEditModal(t),this.backgroundPoints.style.height=this.backgroundModal.offsetHeight+"px",this.backgroundPoints.style.display="block",window.scrollTo(0,0)},this.perfPoints.appendChild(e),this.perfPoints.appendChild(s)}};isEmpty=t=>{for(var e in t)if(t.hasOwnProperty(e))return!1;return JSON.stringify(t)===JSON.stringify({})};fillPointsEditModal=(e={})=>{let s,n,i,a,l;const r=document.getElementById("left-table").firstChild,o=document.getElementById("right-table").firstChild;for(;r.childNodes.length>1;)r.childNodes[1].remove();for(;o.childNodes.length>1;)o.childNodes[1].remove();this.totalPointsNum=this.countPointsNum(e),document.getElementById("total-points-num").textContent=this.countPointsNum(e)+" шт.";for(const t in e.leftSide){if(this.isEmpty(e.leftSide[t]))continue;let n,o,d;s=document.createElement("tr"),s.setAttribute("class","left-point-rope"),s.appendChild(document.createElement("td")),i=document.createElement("td"),a=document.createElement("td"),l=document.createElement("td"),n=document.createElement("input"),n.setAttribute("type","number"),n.setAttribute("class","lines"),n.value=e.leftSide[t].stalls.split("/")[0],o=document.createElement("span"),o.textContent="/",d=document.createElement("input"),d.setAttribute("type","number"),d.setAttribute("class","lines"),d.value=e.leftSide[t].stalls.split("/")[1],i.appendChild(n),i.appendChild(o),i.appendChild(d);let c=document.createElement("input");c.setAttribute("type","number"),c.setAttribute("class","meters"),c.value=e.leftSide[t].meters,a.appendChild(c);let h=document.createElement("input");h.setAttribute("type","number"),h.setAttribute("class","machine"),h.value=e.leftSide[t].machine,l.appendChild(h);let u=document.createElement("span");u.setAttribute("class","del-point-rope"),u.textContent="X",u.onclick=t=>{confirm("Удалить эту точку подвеса?")&&(t.target.parentElement.parentElement.remove(),this.totalPointsNum--,this.totalPointsSpan.textContent=this.totalPointsNum+" шт.")},l.appendChild(u),s.appendChild(i),s.appendChild(a),s.appendChild(l),r.appendChild(s)}for(const r in e.rightSide){if(this.isEmpty(e.rightSide[r]))continue;let d,c,h;n=document.createElement("tr"),n.setAttribute("class","right-point-rope"),n.appendChild(document.createElement("td")),i=document.createElement("td"),a=document.createElement("td"),l=document.createElement("td"),d=document.createElement("input"),d.setAttribute("type","number"),d.setAttribute("class","lines"),d.value=e.rightSide[r].stalls.split("/")[0],c=document.createElement("span"),c.thenextContent="/",h=document.createElement("input"),h.setAttribute("type","number"),h.setAttribute("class","lines"),h.value=e.rightSide[r].stalls.split("/")[1],i.appendChild(d),i.appendChild(c),i.appendChild(h);let u=document.createElement("input");u.setAttribute("type","number"),u.setAttribute("class","meters"),u.value=e.rightSide[t].meters,a.appendChild(u);let p=document.createElement("input");p.setAttribute("type","number"),p.setAttribute("class","machine"),p.value=e.rightSide[r].machine,l.appendChild(p);let m=document.createElement("span");m.setAttribute("class","del-point-rope"),m.textContent="X",m.onclick=t=>{confirm("Удалить эту точку подвеса?")&&(t.target.parentElement.parentElement.remove(),this.totalPointsNum--,this.totalPointsSpan.textContent=this.totalPointsNum+" шт."),l.appendChild(m),s.appendChild(i),s.appendChild(a),s.appendChild(l),o.appendChild(n)}}};countPointsNum=t=>{let e=0;if(!t)return 0;for(let s in t.leftSide)this.isEmpty(t.leftSide[s])||e++;for(let s in t.rightSide)this.isEmpty(t.rightSide[s])||e++;return e};fillUserPointsTable=t=>{let e,s,n,i,a,l=document.getElementById("left-usr-table").firstChild,r=document.getElementById("right-usr-table").firstChild;for(;l.childNodes.length>1;)l.childNodes[1].remove();for(;r.childNodes.length>1;)r.childNodes[1].remove();document.getElementById("total-user-points").textContent=this.countPointsNum(t)+" шт.";for(const s in t.leftSide)e=document.createElement("tr"),e.appendChild(document.createElement("td")),n=document.createElement("td"),i=document.createElement("td"),a=document.createElement("td"),n.textContent=t.leftSide[s].stalls,e.appendChild(n),i.textContent=t.leftSide[s].meters,e.appendChild(i),a.textContent=t.leftSide[s].machine,e.appendChild(a),l.appendChild(e);for(const e in t.rightSide)s=document.createElement("tr"),s.appendChild(document.createElement("td")),n=document.createElement("td"),i=document.createElement("td"),a=document.createElement("td"),n.textContent=t.rightSide[e].stalls,s.appendChild(n),i.textContent=t.rightSide[e].meters,s.appendChild(i),a.textContent=t.rightSide[e].machine,s.appendChild(a),r.appendChild(s)};saveEditingPoints=()=>{const e=document.getElementsByClassName("left-point-rope"),s=document.getElementsByClassName("right-point-rope");if(this.pointsData={leftSide:{},rightSide:{}},0!=e.length||0!=s.length){for(let t=0;t<e.length;t++){this.pointsData.leftSide["point"+(t+1)]={};for(let s=1;s<e[t].childNodes.length;s++)if(1==s){let n=e[t].childNodes[s].firstChild,i=e[t].childNodes[s].lastChild;if(!n.value)return n.parentElement.style.backgroundColor="red",n.onclick=()=>{n.parentElement.style.backgroundColor="initial"},void alert("Пустые поля недопустимы, заполните либо удалите пустые точки подвеса");if(!i.value)return i.parentElement.style.backgroundColor="red",i.onclick=()=>{i.parentElement.style.backgroundColor="initial"},void alert("Пустые поля недопустимы, заполните либо удалите пустые точки подвеса");this.pointsData.leftSide["point"+(t+1)].stalls=n.value+"/"+i.value}else if(2==s){if(!e[t].childNodes[s].firstChild.value)return e[t].childNodes[s].firstChild.parentElement.style.backgroundColor="red",e[t].childNodes[s].firstChild.onclick=()=>{e[t].childNodes[s].firstChild.parentElement.style.backgroundColor="initial"},void alert("Пустые поля недопустимы, заполните либо удалите пустые точки подвеса");this.pointsData.leftSide["point"+(t+1)].meters=e[t].childNodes[s].firstChild.value}else 3==s&&(this.pointsData.leftSide["point"+(t+1)].machine=e[t].childNodes[s].firstChild.value)}for(let e=0;e<s.length;e++){this.pointsData.rightSide["point"+(e+1)]={};for(let n=1;n<s[e].childNodes.length;n++)if(1==n){let t=s[e].childNodes[n].firstChild,i=s[e].childNodes[n].lastChild;if(!t.value)return t.parentElement.style.backgroundColor="red",t.onclick=()=>{t.parentElement.style.backgroundColor="initial"},void alert("Пустые поля недопустимы, заполните либо удалите пустые точки подвеса");if(!i.value)return i.parentElement.style.backgroundColor="red",i.onclick=()=>{i.parentElement.style.backgroundColor="initial"},void alert("Пустые поля недопустимы, заполните либо удалите пустые точки подвеса");this.pointsData.rightSide["point"+(e+1)].stalls=t.value+"/"+i.value}else if(2==n){if(!s[e].childNodes[n].firstChild.value)return s[e].childNodes[n].firstChild.parentElement.style.backgroundColor="red",s[e].childNodes[n].firstChild.onclick=()=>{s[e].childNodes[n].firstChild.parentElement.style.backgroundColor="initial"},void alert("Пустые поля недопустимы, заполните либо удалите пустые точки подвеса");this.pointsData.rightSide["point"+(e+1)].meters=s[e].childNodes[n].firstChild.value}else 3==n&&(this.pointsData.rightSide["point"+(e+1)].machine=t[e].childNodes[n].firstChild.value)}this.fillEditCardPointsDiv(this.pointsData),this.backgroundPoints.style.display="none"}else this.backgroundPoints.style.display="none"};addAct=()=>{let s=this.perfActs.childNodes.length+1,n=document.createElement("div"),i=document.createElement("span"),a=document.createElement("input"),l=document.createElement("span");n.setAttribute("class","act-line"),i.setAttribute("class","perf-act"),i.setAttribute("id","perf-act"+t),i.textContent=s+":",a.setAttribute("type","text"),a.setAttribute("class","act-time"),a.setAttribute("id","act-time"+s),a.setAttribute("placeholder","1ч 15мин"),l.setAttribute("id","del-act-btn"+t),l.setAttribute("class","del-act-btn"),l.textContent="X",l.onclick=()=>{l.parentElement.remove()},n.appendChild(i),n.appendChild(a),n.appendChild(l),this.perfActs.insertBefore(n,this.perfActs.childNodes[e])};checkActs=()=>{let t=this.perfActs.childNodes.length,e=this.perfActs.childNodes;for(let s=0;s<t;s++)if(!e[s].childNodes[1].value)return e[s].childNodes[1].style.borderColor="red",e[s].childNodes[1].onclick=()=>e[s].childNodes[1].style.borderColor="initial",!1;return!0};inputsValid=()=>this.perfName.value?this.perfType.value?!!this.checkActs()||(this.perfActs.borderColor="red",!1):(this.perfType.style.borderColor="red",!1):(this.perfName.style.borderColor="red",!1);save=async(t,e)=>{if("update"===e||"create"===e){if(this.inputsValid()){let s=this.perfName.value,n=this.perfType.value,i=this.perfUrl.value,a=[],l=this.perfNotes.value;for(let t=0;t<this.perfActs.childNodes.length;t++){if(this.perfActs.childNodes[t].childNodes[1].value.includes(","))return this.perfActs.childNodes[t].childNodes[1].style.borderColor="red";a.push(this.perfActs.childNodes[t].childNodes[1].value)}if(t&&"update"===e){let r={name:s,type:n,imgUrl:i,acts:a,points:this.pointsData,notes:l,perfId:t,action:e};return"OK"==(await request("/performances","POST",r)).statusText?(alert("Спектакль обновлен успешно"),this.backgroundModal.style.display="none",void window.location.reload()):void alert("Ошибка во время сохранения")}if(!t&&"create"==e){let r={name:s,type:n,imgUrl:i,acts:a,points:this.pointsData,notes:l,perfId:t,action:e};if("OK"!=(await request("/performances","POST",r)).statusText)return void alert("Ошибка во время создания");alert("Новый спектакль успешно добавлен"),window.location.reload()}}}else if("remove"===e){let s={perfId:t,action:e};return"OK"==(await request("/performances","POST",s)).statusText?(alert("Спектакль успешно удалён"),void window.location.reload()):void alert("Ошибка удаления")}};addPoint=t=>{const e=document.createElement("tr"),s=document.createElement("span");s.textContent="/";for(let t=0;t<4;t++){let n=document.createElement("td");if(1==t)for(let t=0;t<2;t++){let e=document.createElement("input");e.setAttribute("type","number"),e.setAttribute("class","lines"),1==t&&n.appendChild(s),n.appendChild(e)}else if(2==t){let t=document.createElement("input");t.setAttribute("type","number"),t.setAttribute("class","meters"),n.appendChild(t)}else if(3==t){let t=document.createElement("input"),e=document.createElement("span");e.textContent="X",e.setAttribute("class","del-point-rope"),e.onclick=t=>{confirm("Удалить эту точку подвеса?")&&(t.target.parentElement.parentElement.remove(),this.totalPointsNum--,this.totalPointsSpan.textContent=this.totalPointsNum+" шт.")},t.setAttribute("type","number"),t.setAttribute("class","machine"),n.appendChild(t),n.appendChild(e)}e.appendChild(n)}e.setAttribute("class",t+"-point-rope"),document.getElementById(t+"-table").appendChild(e),this.totalPointsNum++,this.totalPointsSpan.textContent=this.totalPointsNum+" шт."}}async function request(t,e,s){return await fetch(t,{method:e,headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})}
//# sourceMappingURL=maps/main.min.js.map
