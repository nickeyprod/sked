function request(e,t,n,i){const l=new XMLHttpRequest;l.onreadystatechange=function(){4==this.readyState&&200==this.status?i("success",this):4==this.readyState&&500==this.status&&i("error",this)},l.open(e,t,!0),!1!==n?(l.setRequestHeader("Content-type","application/x-www-form-urlencoded"),l.send(n)):l.send()}function Auth(){const e=this;this.authBt=document.getElementById("auth-bt"),this.login=document.getElementById("login"),this.pass=document.getElementById("pass"),this.authBt.onclick=function(){let t=e.login.value,n=e.pass.value;if(!t||!n)return alert("Отсутствует логин или пароль");request("POST","/auth",`login=${t}&pass=${n}`,(function(e,t){if("success"==e)return alert("Авторизация успешна и будет действительна в течение 30 дней"),window.location.href="/";"error"!=e||alert("Ошибка авторизации, проверьте введённые Вами данные")}))}}function Authenticate(){const e=this;this.login=document.getElementById("login"),this.pass1=document.getElementById("pass1"),this.pass2=document.getElementById("pass2"),this.authenBt=document.getElementById("authenticate-bt"),this.login.onclick=function(){e.login.style.borderColor="initial"},this.pass1.onclick=function(){e.pass1.style.borderColor="initial"},this.pass2.onclick=function(){e.pass2.style.borderColor="initial"},this.authenBt.onclick=function(){if(!e.login.value)return e.login.style.borderColor="red";if(!e.pass1.value)return e.pass1.style.borderColor="red";if(!e.pass2.value)return e.pass2.style.borderColor="red";let t=e.login.value,n=e.pass1.value,i=e.pass2.value,l=`login=${t}&pass1=${n}&pass2=${i}`;if(n!==i)return alert("Введённые пароли не совпадают");request("POST","/authenticate",l,(function(e,t){return"success"==e?(alert("Аутентификация успешна, сейчас вы будете перенаправлены на страницу логина"),window.location.href="/auth"):"error"==e?(console.log(t.statusText),void alert("Ошибка аутентификации, проверьте все поля")):void 0}))}}function Performance(){let e=document.getElementsByTagName("body");e[0].style.backgroundImage="url('/static/imgs/backgr-bsh.jpg')",e[0].style.backgroundRepeat="no-repeat";const t=this;this.pointsData={leftSide:{},rightSide:{}},this.totalPointsNum=0,this.addPerfBtn=document.getElementById("add-performance-btn"),this.searchInpt=document.getElementById("search-perfs"),this.backgroundModal=document.getElementById("background-modal"),this.closeAddPerf=document.getElementById("close-adding-perf"),this.savePerfBtn=document.getElementById("save-perf-btn"),this.perfName=document.getElementById("perf-name"),this.perfType=document.getElementById("perf-type"),this.perfUrl=document.getElementById("perf-pic-url"),this.perfActs=document.getElementById("perf-acts"),this.perfPoints=document.getElementById("perf-points"),this.perfNotes=document.getElementById("perf-notes"),this.addActBtn=document.getElementById("add-act"),this.searchResults=document.getElementById("search-results"),this.closeCardPerf=document.getElementById("close-card-perf"),this.backgroundCard=document.getElementById("card-back"),this.addPointsBtn=document.getElementById("add-points"),this.addRightPointBtn=document.getElementById("add-right-pt-btn"),this.addLeftPointBtn=document.getElementById("add-left-pt-btn"),this.backgroundPoints=document.getElementById("points-back"),this.closePointsBtn=document.getElementById("close-points-perf"),this.acceptPointsBtn=document.getElementById("accept-points-btn"),this.userPointsBack=document.getElementById("user-points-back"),this.closeUserPoints=document.getElementById("close-user-points"),this.perfImage=document.getElementById("perf-img"),this.cardPerfName=document.getElementById("card-perf-name"),this.cardPerfType=document.getElementById("card-perf-type"),this.cardPerfActs=document.getElementById("card-perf-acts"),this.cardPerfPoints=document.getElementById("card-perf-points"),this.cardPerfNotes=document.getElementById("card-perf-notes"),this.totalPointsSpan=document.getElementById("total-points-num"),this.searchInpt.oninput=function(){t.searchResults.innerHTML="";if(!/^\s*$/.test(t.searchInpt.value)){request("post","/perf-search",`query=${t.searchInpt.value}`,(function(e,n){if("success"==e){const e=JSON.parse(n.responseText).perfs;let i;t.searchResults.style.display="block";for(let n=0;n<e.length;n++)(i=document.createElement("div")).setAttribute("class","perf-name-found"),i.textContent=e[n].name,i.onclick=function(){var i;t.cardPerfName.textContent=e[n].name,e[n].imgUrl?(t.perfImage.src="/static/imgs/performance-imgs/"+e[n].imgUrl,t.perfImage.style.display="block"):(t.perfImage.src="",t.perfImage.style.display="none");let l=e[n].acts.length;var o,s,d;i=1==l?"акт":l>1&&l<5?"акта":"актов","ballet"==e[n].type?t.cardPerfType.textContent=`Балет, ${l} ${i}`:"opera"==e[n].type&&(t.cardPerfType.textContent=`Опера, ${e[n].acts.length} ${i}`),t.cardPerfActs.innerHTML="";for(let i=0;i<e[n].acts.length;i++)(o=document.createElement("div")).setAttribute("class","act-line"),(s=document.createElement("span")).textContent=`${i+1} Акт:`,(d=document.createElement("span")).textContent=`${e[n].acts[i]}`,o.appendChild(s),o.appendChild(d),t.cardPerfActs.appendChild(o);if(e[n].points){if(2==t.cardPerfPoints.childNodes.length){t.cardPerfPoints.removeChild(t.cardPerfPoints.childNodes[1]);let i=document.createElement("p");i.setAttribute("class","total-points-usr"),i.textContent="Всего: "+t.countPointsNum(e[n].points)+" шт.";let l=document.createElement("button");l.setAttribute("class","showPoints-btn"),l.onclick=function(){t.fillUserPointsModal(e[n].points),window.scrollTo(0,0),t.userPointsBack.style.display="block"},l.textContent="Просмотр",t.cardPerfPoints.appendChild(i),3!=t.cardPerfPoints.childNodes.length&&t.cardPerfPoints.appendChild(l)}}else if(t.pointsData={leftSide:{},rightSide:{}},3==t.cardPerfPoints.childNodes.length){t.cardPerfPoints.removeChild(t.cardPerfPoints.childNodes[1]),t.cardPerfPoints.removeChild(t.cardPerfPoints.childNodes[1]);let e=document.createElement("i");e.innerHTML="&ndash; Отсутствуют",t.cardPerfPoints.appendChild(e)}if(""!=e[n].notes&&(t.cardPerfNotes.textContent=e[n].notes),"true"===admin){let i=document.createElement("button");i.setAttribute("class","edit-btn"),i.textContent="Редактировать",i.onclick=function(){t.openEdit(e[n])};let l=document.createElement("button");l.setAttribute("class","rm-perf-btn"),l.textContent="Удалить",l.onclick=function(){confirm(`Вы действительно хотите удалить спектакль "${e[n].name}" из базы?`)&&t.save(e[n]._id,"remove")},5==t.cardPerfName.parentElement.childNodes.length?(t.cardPerfName.parentElement.appendChild(i),t.cardPerfName.parentElement.appendChild(l)):(t.cardPerfName.parentElement.childNodes[5].remove(),t.cardPerfName.parentElement.childNodes[5].remove(),t.cardPerfName.parentElement.appendChild(i),t.cardPerfName.parentElement.appendChild(l))}t.savePerfBtn.onclick=function(){t.save(e[n]._id,"update")},t.backgroundCard.style.display="block"},t.searchResults.appendChild(i);0==e.length&&((i=document.createElement("div")).setAttribute("class","perf-name-found nothing-found"),i.textContent="Ничего не найдено",t.searchResults.appendChild(i))}else if("err"==e)return}))}},this.openEdit=function(e){if(t.backgroundCard.style.display="none",t.backgroundModal.style.display="block",this.perfName.value=e.name,this.perfType.value=e.type,this.perfUrl.value=e.imgUrl,e.acts.length>0){let n,i,l,o,s;this.perfActs.innerHTML="";for(let d=0;d<e.acts.length;d++)(n=document.createElement("actLine")).setAttribute("class","act-line"),(i=document.createElement("span")).setAttribute("class","perf-act"),i.textContent=d+1+":",n.appendChild(i),(l=document.createElement("input")).setAttribute("class","act-time"),l.setAttribute("type","text"),l.setAttribute("placeholder","1ч 15мин"),l.value=e.acts[d],n.appendChild(l),0==d?((s=document.createElement("button")).setAttribute("class","add-mini-btn"),s.textContent="+",s.onclick=function(){t.addAct()},n.appendChild(s)):((o=document.createElement("span")).setAttribute("class","del-act-btn"),o.textContent="X",o.onclick=function(e){e.target.parentElement.remove()},n.appendChild(o)),em=document.createElement("button"),i.setAttribute("class","perf-act"),this.perfActs.appendChild(n)}if(e.points){t.perfPoints.childNodes[0].remove(),t.perfPoints.childNodes[0].remove();let n=document.createElement("span");n.setAttribute("class","points-number"),n.textContent=t.countPointsNum(e.points)+" шт.";let i=document.createElement("span");i.setAttribute("class","showPoints-btn"),i.textContent="Редактировать",i.onclick=function(){t.fillPointsEditModal(e.points),t.backgroundPoints.style.display="block"},t.perfPoints.appendChild(n),t.perfPoints.appendChild(i)}else{let e,n;t.perfPoints.childNodes[0].remove(),t.perfPoints.childNodes[0].remove(),(e=document.createElement("span")).textContent="- Нет",e.setAttribute("class","no-points"),(n=document.createElement("button")).setAttribute("class","add-mini-btn"),n.textContent="+",n.onclick=function(){let e=document.getElementById("left-table"),n=document.getElementById("right-table");for(;1!=e.childNodes.length;)e.childNodes[e.childNodes.length-1].remove();for(;1!=n.childNodes.length;)n.childNodes[n.childNodes.length-1].remove();t.totalPointsNum=0,document.getElementById("total-points-num").textContent="0 шт.",t.backgroundPoints.style.display="block"},t.perfPoints.appendChild(e),t.perfPoints.appendChild(n)}this.perfNotes.value=e.notes},this.fillPointsEditModal=function(e){let n=document.getElementById("left-table"),i=document.getElementById("right-table");for(;1!=n.childNodes.length;)n.childNodes[n.childNodes.length-1].remove();for(;1!=i.childNodes.length;)i.childNodes[i.childNodes.length-1].remove();t.totalPointsNum=t.countPointsNum(e);let l,o,s,d,r,a=document.getElementById("total-points-num");for(key1 in a.textContent=t.countPointsNum(e)+" шт.",e.leftSide){let t,i,o;(l=document.createElement("tr")).setAttribute("class","left-point-rope"),l.appendChild(document.createElement("td")),s=document.createElement("td"),d=document.createElement("td"),r=document.createElement("td"),(t=document.createElement("input")).setAttribute("type","number"),t.setAttribute("class","lines"),t.value=e.leftSide[key1].stalls.split("/")[0],(i=document.createElement("span")).textContent="/",(o=document.createElement("input")).setAttribute("type","number"),o.setAttribute("class","lines"),o.value=e.leftSide[key1].stalls.split("/")[1],s.appendChild(t),s.appendChild(i),s.appendChild(o);let a=document.createElement("input");a.setAttribute("type","number"),a.setAttribute("class","meters"),a.value=e.leftSide[key1].meters,d.appendChild(a);let c=document.createElement("input");c.setAttribute("type","number"),c.setAttribute("class","machine"),c.value=e.leftSide[key1].machine,r.appendChild(c);let u=document.createElement("span");u.setAttribute("class","del-point-rope"),u.textContent="X",u.onclick=function(e){e.target.parentElement.parentElement.remove()},r.appendChild(u),l.appendChild(s),l.appendChild(d),l.appendChild(r),n.appendChild(l)}for(key2 in e.rightSide){let t,n,l;(o=document.createElement("tr")).setAttribute("class","right-point-rope"),o.appendChild(document.createElement("td")),s=document.createElement("td"),d=document.createElement("td"),r=document.createElement("td"),(t=document.createElement("input")).setAttribute("type","number"),t.setAttribute("class","lines"),t.value=e.rightSide[key2].stalls.split("/")[0],(n=document.createElement("span")).textContent="/",(l=document.createElement("input")).setAttribute("type","number"),l.setAttribute("class","lines"),l.value=e.rightSide[key2].stalls.split("/")[1],s.appendChild(t),s.appendChild(n),s.appendChild(l);let a=document.createElement("input");a.setAttribute("type","number"),a.setAttribute("class","meters"),a.value=e.rightSide[key2].meters,d.appendChild(a);let c=document.createElement("input");c.setAttribute("type","number"),c.setAttribute("class","machine"),c.value=e.rightSide[key2].machine,r.appendChild(c);let u=document.createElement("span");u.setAttribute("class","del-point-rope"),u.textContent="X",u.onclick=function(e){e.target.parentElement.parentElement.remove()},r.appendChild(u),o.appendChild(s),o.appendChild(d),o.appendChild(r),i.appendChild(o)}},this.countPointsNum=function(e){let t=0;for(key1 in e.leftSide)t++;for(key1 in e.rightSide)t++;return t},this.fillUserPointsModal=function(e){let n=document.getElementById("left-usr-table"),i=document.getElementById("right-usr-table");for(;n.childNodes[1];)n.childNodes[1].remove();for(;i.childNodes[1];)i.childNodes[1].remove();let l,o,s,d,r,a=document.getElementById("total-user-points");for(key1 in a.textContent=t.countPointsNum(e)+" шт.",e.leftSide)(l=document.createElement("tr")).appendChild(document.createElement("td")),s=document.createElement("td"),d=document.createElement("td"),r=document.createElement("td"),s.textContent=e.leftSide[key1].stalls,l.appendChild(s),d.textContent=e.leftSide[key1].meters,l.appendChild(d),r.textContent=e.leftSide[key1].machine,l.appendChild(r),n.appendChild(l);for(key2 in e.rightSide)(o=document.createElement("tr")).appendChild(document.createElement("td")),s=document.createElement("td"),d=document.createElement("td"),r=document.createElement("td"),s.textContent=e.rightSide[key2].stalls,o.appendChild(s),d.textContent=e.rightSide[key2].meters,o.appendChild(d),r.textContent=e.rightSide[key2].machine,o.appendChild(r),i.appendChild(o)},this.closeUserPoints.onclick=function(){t.userPointsBack.style.display="none"},this.acceptPointsBtn.onclick=function(){let e=document.getElementsByClassName("left-point-rope"),n=document.getElementsByClassName("right-point-rope");if(0==e.length&&0==n.length)return t.pointsData={},void(t.backgroundPoints.style.display="none");for(let n=0;n<e.length;n++){t.pointsData.leftSide["point"+(n+1)]={};for(let i=1;i<e[n].childNodes.length;i++)if(1==i){let l=e[n].childNodes[i].firstChild,o=e[n].childNodes[i].lastChild;if(!l.value)return alert("Пустые ячейки недопустимы"),l.parentElement.style.backgroundColor="#ff6d6d",void(l.onclick=function(){l.parentElement.style.backgroundColor="initial"});o.value||(alert("Пустые ячейки недопустимы"),o.parentElement.style.backgroundColor="#ff6d6d",o.onclick=function(){o.parentElement.style.backgroundColor="initial"}),t.pointsData.leftSide["point"+(n+1)].stalls=l.value+"/"+o.value}else if(2==i){if(!e[n].childNodes[i].firstChild.value)return alert("Пустые ячейки недопустимы"),e[n].childNodes[i].firstChild.parentElement.style.backgroundColor="#ff6d6d",void(e[n].childNodes[i].firstChild.onclick=function(){e[n].childNodes[i].firstChild.parentElement.style.backgroundColor="initial"});t.pointsData.leftSide["point"+(n+1)].meters=e[n].childNodes[i].firstChild.value}else 3==i&&(t.pointsData.leftSide["point"+(n+1)].machine=e[n].childNodes[i].firstChild.value)}for(let e=0;e<n.length;e++){t.pointsData.rightSide["point"+(e+1)]={};for(let i=1;i<n[e].childNodes.length;i++)if(1==i){let l=n[e].childNodes[i].firstChild,o=n[e].childNodes[i].lastChild;if(!l.value)return alert("Пустые ячейки недопустимы"),l.parentElement.style.backgroundColor="#ff6d6d",void(l.onclick=function(){l.parentElement.style.backgroundColor="initial"});if(!o.value)return alert("Пустые ячейки недопустимы"),o.parentElement.style.backgroundColor="#ff6d6d",void(o.onclick=function(){o.parentElement.style.backgroundColor="initial"});t.pointsData.rightSide["point"+(e+1)].stalls=l.value+"/"+o.value}else if(2==i){if(!n[e].childNodes[i].firstChild.value)return alert("Пустые ячейки недопустимы"),n[e].childNodes[i].firstChild.parentElement.style.backgroundColor="#ff6d6d",void(n[e].childNodes[i].firstChild.onclick=function(){n[e].childNodes[i].firstChild.parentElement.style.backgroundColor="initial"});t.pointsData.rightSide["point"+(e+1)].meters=n[e].childNodes[i].firstChild.value}else 3==i&&(t.pointsData.rightSide["point"+(e+1)].machine=n[e].childNodes[i].firstChild.value)}t.perfPoints.childNodes[t.perfPoints.childNodes.length-1].remove(),t.perfPoints.childNodes[t.perfPoints.childNodes.length-1].remove();let i=document.createElement("span");i.setAttribute("class","points-number"),i.textContent=t.totalPointsNum+" шт. ";let l=document.createElement("span");l.setAttribute("class","showPoints-btn"),l.setAttribute("id","showPoints-btn"),l.onclick=function(){t.backgroundPoints.style.display="block"},l.textContent="Просмотр",t.perfPoints.appendChild(i),t.perfPoints.appendChild(l),t.backgroundPoints.style.display="none"},this.closePointsBtn.onclick=function(){return alert('Чтобы сохранить изменения, нажмите "подтвердить", после чего нажмите "сохранить", иначе внесенные изменения будут проигнорированы.'),t.backgroundPoints.style.display="none"},this.addPointsBtn.onclick=function(){t.backgroundPoints.style.display="block"},this.closeCardPerf.onclick=function(){t.savePerfBtn.onclick=function(){t.save(!1,"create")},t.backgroundCard.style.display="none"},"true"===admin&&(this.addPerfBtn.onclick=function(){t.backgroundModal.style.display="block"}),this.closeAddPerf.onclick=function(){t.backgroundModal.style.display="none"},this.savePerfBtn.onclick=function(){t.save(!1,"create")},this.perfName.onclick=function(){t.perfName.style.borderColor="initial"},this.perfType.onclick=function(){t.perfType.style.borderColor="initial"},this.addActBtn.onclick=function(){t.addAct()},this.addRightPointBtn.onclick=function(){t.addPoint("right")},this.addLeftPointBtn.onclick=function(){t.addPoint("left")},this.addAct=function(){let e=t.perfActs.childNodes.length,n=e+1,i=document.createElement("div"),l=document.createElement("span"),o=document.createElement("input"),s=document.createElement("span");i.setAttribute("class","act-line"),l.setAttribute("class","perf-act"),l.setAttribute("id","perf-act"+n),l.textContent=n+":",o.setAttribute("type","text"),o.setAttribute("class","act-time"),o.setAttribute("id","act-time"+n),o.setAttribute("placeholder","1ч 15мин"),s.setAttribute("id","del-act-btn"+n),s.setAttribute("class","del-act-btn"),s.textContent="X",s.onclick=function(){s.parentElement.remove()},i.appendChild(l),i.appendChild(o),i.appendChild(s),t.perfActs.insertBefore(i,t.perfActs.childNodes[e])},this.checkActs=function(){let e=t.perfActs.childNodes.length,n=t.perfActs.childNodes;for(let t=0;t<e;t++)if(!n[t].childNodes[1].value)return n[t].childNodes[1].style.borderColor="red",n[t].childNodes[1].onclick=function(){return n[t].childNodes[1].style.borderColor="initial"},!1;return!0},this.save=function(e,n){if("remove"!==n){if(!t.perfName.value)return t.perfName.style.borderColor="red";if(!t.perfType.value)return t.perfType.style.borderColor="red";if(!t.checkActs())return t.perfActs.borderColor="red";{let l=t.perfName.value,o=t.perfType.value,s=t.perfUrl.value,d=[],r=t.perfNotes.value;function i(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return JSON.stringify(e)===JSON.stringify({})}i(t.pointsData.leftSide)&&i(t.pointsData.rightSide)&&(t.pointsData={});for(let e=0;e<t.perfActs.childNodes.length;e++){if(t.perfActs.childNodes[e].childNodes[1].value.includes(","))return void(t.perfActs.childNodes[e].childNodes[1].style.borderColor="red");d.push(t.perfActs.childNodes[e].childNodes[1].value)}if(e&&"update"===n){request("post","/performances",`name=${l}&type=${o}&imgUrl=${s}&acts=${d}&points=${JSON.stringify(t.pointsData)}&notes=${r}&perfId=${e}&action=${n}`,(function(e,n){if("success"==e)alert("Удачно обновлено"),t.backgroundModal.style.display="none",window.location.reload();else if("err"==e)return}))}else e||"create"!=n||(perfData=`name=${l}&type=${o}&imgUrl=${s}&acts=${d}&points=${JSON.stringify(t.pointsData)}&notes=${r}&action=${n}`,request("post","/performances",perfData,(function(e,n){if("success"==e)alert("Удачно создано"),t.backgroundModal.style.display="none",window.location.reload();else if("err"==e)return})))}}else perfData=`perfId=${e}&action=${n}`,request("post","/performances",perfData,(function(e,n){if("success"==e)alert("Успешно удалено"),t.backgroundModal.style.display="none",window.location.reload();else if("err"==e)return}))},this.addPoint=function(e){let n=document.createElement("tr"),i=document.createElement("span");i.textContent="/";for(let e=0;e<4;e++){let l=document.createElement("td");if(1==e)for(let e=0;e<2;e++){let t=document.createElement("input");t.setAttribute("type","number"),t.setAttribute("class","lines"),1==e&&l.appendChild(i),l.appendChild(t)}else if(2==e){let e=document.createElement("input");e.setAttribute("type","number"),e.setAttribute("class","meters"),l.appendChild(e)}else if(3==e){let e=document.createElement("input"),n=document.createElement("span");n.textContent="X",n.setAttribute("class","del-point-rope"),n.onclick=function(e){confirm("Удалить эту точку подвеса?")&&(e.target.parentElement.parentElement.remove(),t.totalPointsNum--,t.totalPointsSpan.textContent=t.totalPointsNum+" шт.")},e.setAttribute("type","number"),e.setAttribute("class","machine"),l.appendChild(e),l.appendChild(n)}n.appendChild(l)}n.setAttribute("class",e+"-point-rope"),document.getElementById(e+"-table").appendChild(n),t.totalPointsNum++,t.totalPointsSpan.textContent=t.totalPointsNum+" шт."}}function SkedApp(){this.init=function(){$(".shift-choose").change((function(e){console.log(e)}))}}
//# sourceMappingURL=maps/main.min.js.map
